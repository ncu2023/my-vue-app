## 目錄
- [2023-11-01 上課筆記](#2023-11-01)
- [2023-11-03 上課筆記](#2023-11-03)
- [2023-11-06 上課筆記](#2023-11-06)
- [2023-11-08 上課筆記](#2023-11-08)
- [2023-11-10 上課筆記](#2023-11-10)
- [2023-11-13 上課筆記](#2023-11-13)
- [2023-11-14 上課筆記](#2023-11-14)
- [2023-11-15 上課筆記](#2023-11-15)
- [2023-11-16 上課筆記](#2023-11-16)
- [2023-11-21 上課筆記](#2023-11-21)
- [2023-11-22 上課筆記](#2023-11-22)
- [2023-11-23 上課筆記](#2023-11-23)
- [2023-11-24 上課筆記](#2023-11-24)
- [2023-11-25 上課筆記](#2023-11-25)
- [2023-11-27 上課筆記](#2023-11-27)
- [2023-11-28 上課筆記](#2023-11-28)
- [2023-11-29 上課筆記](#2023-11-29)
- [2023-11-30 上課筆記](#2023-11-30)
- [2023-12-01 上課筆記](#2023-12-01)
- [2023-12-04 上課筆記](#2023-12-04)
- [2023-12-05 上課筆記](#2023-12-05)
- [2023-12-06 上課筆記](#2023-12-06)

## 2023-11-01
## Markdown
工程師的文件格式: https://markdown.tw/#em

## dbeaver
一個免費的萬用且跨平台的資料庫管理工具

下載網址: https://dbeaver.io/download/ 

## mySQL
下載community: https://dev.mysql.com/downloads/mysql/
> **補充:**
> 需先下載VStudio 2019 distubrition: https://aka.ms/vs/17/release/vc_redist.x64.exe

#### 設定步驟:
![](imgs\install-mysql.png)

1. Type and Networking: 設定資料庫用在甚麼地方
2. 設定root密碼；建立其他資料庫帳號
3. Windows Service: 選擇系統服務的模式: 標準就好
4. Server File Permissions: 設定甚麼帳號可以存取資料庫
5. Sampe Datebase: 建立範例資料庫: 不需要
6. Apply Configuration: 執行以上設定

#### dbeaver連接mySQL
![](imgs\connect-mysql.png)
> **補充:**
> 第一次連接mySql會需要安裝driver

#### 透過dbeaver建立table
```sql
create table account(
   id integer primary key,
   name varchar(32),
   phone varchar(16)
);
```

#### join
![](imgs\join.jpg)

```
select a.name, a.phone, u.address, u.`level` 
from account a 
join user u on a.id = u.id; 
```

```
select * from account a left join user u on a.id = u.id;
```
```
select * from account a left join user u on a.id = u.id
where u.id is null;

```

#### 資料庫dump與restore
在資料庫上點右鍵->Tools->Dump database = 備份資料庫
在資料庫上點右鍵->Tools->Restore database = 復原資料庫

# 2023-11-03
#### 一個很棒的樣板網站
HTML5UP: https://html5up.net/

#### 一個很多網頁元件樣板的網站
FreeFrontEnd: https://freefrontend.com/

#### 下載Maven套件管理工具
https://dlcdn.apache.org/maven/maven-3/3.9.5/binaries/apache-maven-3.9.5-bin.zip

Apache Maven: https://maven.apache.org/download.cgi

## 建立後端開發環境

#### 安裝Maven
- 下載後解壓縮到合適的位置
- 打開系統的環境變數編輯視窗
  > 設定->系統->關於->系統資訊->進階系統設定->環境變數
- 在下方的系统中建立`MAVEN_HOME`變數，變數值為MAVEN路徑，如 D:\apache-maven-3.9.2-bin\apache-maven-3.9.2
- 在上方用户變數中的`Path`變數内，新增`%MAVEN_HOME%\bin`
- 點擊確定

#### 測試安裝
- 打開「命令提示字元」或VSCode終端機。
- 輸入`mvn -version`

如果能正確顯示版本號碼，則代表安裝成功。

#### 安裝VSCode extension
##### Community Server Connectors
用途：用來安裝與管理Tomcat後端伺服器用。

##### Extension Pack for Java
裡面已包含了6個套件：

- Language Support for Java™ by Red Hat
- Debugger for Java
- Test Runner for Java
- Maven for Java
- Project Manager for Java
- Visual Studio IntelliCode

#### 建立VSCode新專案
- Ctrl+Shift+P，輸入java，選擇Maven: Create from archetype
- 選擇maven-archetype-webapp

- 選擇1.4
- Group Id直接Enter
- artifact Id直接Enter
- 選擇一個合適的目錄即可
- 然后下方終端機會詢問一些問題，直接Enter兩次即可
- 出現綠色的BUILD SUCCESS表示建立成功，可以點右下角藍色按鈕打開project
> 提示:
> 如果出現The terminal process failed to launch: Path to shell executable "cmd.exe" does not exist錯誤訊息，請將`C:\Windows\System32`加到環境變數內的使用者環境變數的Path變數內。

#### 修改pom.xml
1.7修改成1.8P
```
<properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.source>1.8</maven.compiler.source>
    <maven.compiler.target>1.8</maven.compiler.target>
  </properties>
```

#### 新增Servlet套件
1. Ctrl+shift+P，输入maven，選擇「新增相依套件」
2. 输入servlet然後enter
3. 選擇javax.servletP

#### 新增mysql-connector套件
1. Ctrl+shift+P，输入maven，選擇「新增相依套件」
2. 输入mysql然後enter
3. 選擇mysql-connector-java

> 1. 有新增相依套件的話，會需要重新編譯maven，此时儲存檔案，右下角會有提示，點及藍色按鈕即可。
> 2. 或者可以手動操作，Ctrl+Shift+P，輸入maven，選擇「執行命令」，選擇「compile」，等待終端機出現Build success即可。

#### 安裝Tomcat Server
1. 在左下角有一些被折疊的欄位，找到SERVERS欄位。
2. 展開後可以看到Community Server Connector(stopped)
3. 點擊滑鼠右鍵，選擇出現的的唯一新選項，「開始RSP Provider」，等待變成「Community Server Connector(started)」。
4. 再次右鍵點擊，選擇建立新伺服器(Create new server)。
5. Download Server，選擇「Yes」，然後選擇Apache-tomcat-9.0.41
6. 選擇Yes同意授權

#### 測試Tomcat
1. 右键Tomcat 9.x(stopped)，選擇開始伺服器
2. 等待變成「Tomcat 9.x(started)」
3. 完成后，打開瀏覽器，輸入：http://localhost:8080可以看到tomcat網頁。

#### 開發一個Servlet
1. 在src/main目錄下新增java目錄(Servlet程式碼根目錄)
2. 新增package目錄com
3. 新增Servlet檔案Hello.java

```java
package com;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class Hello extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
        // 設定回應的文字編碼
        response.setContentType("text/html;charset=UTF-8");

        // 取得可以回應資料給前端的物件
        PrintWriter pw = response.getWriter();

        // 輸出資料給前端
        pw.print("<!DOCTYPE html>");
        pw.print("<html>");
        pw.print("<head><title>我的Servlet</title></head>");
        pw.print("<body><h1>Hello Servlet</h1></body>");
        pw.print("</head>");
    }
}
```

#### 修改src/webapp/WEB-INF目錄下的web.xml
##### 新增servlet設定
```xml
<web-app>
  <display-name>Archetype Created Web Application</display-name>
  <servlet>
    <servlet-name>Hello</servlet-name>
    <servlet-class>com.Hello</servlet-class>
  </servlet>
  <servlet-mapping>
    <servlet-name>Hello</servlet-name>
    <url-pattern>/test</url-pattern>
  </servlet-mapping>
</web-app>
```

#### 部署到Tomcat中
##### 打包專案
1. Ctrl+Shift+P，輸入maven，選擇「執行命令」，再選擇「package」

##### 加入到Tomcat伺服器中
1. 右键点击Tomcat 9.x(started)，選擇Add Deployment，選擇target\demo.war
2. 選擇No（不修改参数）
3. 右键點擊Tomcat 9.x(started)，選擇Publish Server(Full)

##### 使用瀏覽器瀏覽Servlet
```bash
http://localhost:8080/demo/test
```

### 資料庫使用者資訊
#### DB Schema
##### Database(資料庫名稱)
my_system
##### Table name(資料表名稱)
account
##### Column:
- id: integer, 主鍵, 自動遞增
- name: varchar(32), 使用者名稱
- code: varchar(64), 密碼
- email: varchar(64), 使用者的email
- phone: varchar(32), 使用者電話

#### 資料庫設計工具
dbdiagram: https://dbdiagram.io/

#### 建立登入用的後端Java
```java
package com;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.google.gson.Gson;
import com.google.protobuf.TextFormat.Printer;
import com.mysql.cj.log.Log;

class LoginResult {
    public LoginResult(String account, String password) {
        this.account = account;
        this.password = password;
    }

    String account;
    String password;    
}

// API的response 資料結構
class ActionResult {
    int code;       // 狀態碼
    String message; // 訊息描述

    LoginResult data; // 登入後預計回傳的資料

    public ActionResult(int code, String message, LoginResult data) {
        this.code = code;
        this.message = message;
        this.data = data;
    }
}

public class Login extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
        // 接收前端網頁傳來的username和password參數
        String username = request.getParameter("username");
        String password = request.getParameter("code");

        // 設定編碼
        response.setContentType("application/json;charset=UTF-8");

        // 準備要回傳給前端的資料
        ActionResult actionResult = new ActionResult(0, "成功", new LoginResult(username, password));

        // 將Java物件轉換成JSON字串才能往前端傳遞
        String jsonString = new Gson().toJson(actionResult);

        // 輸出到終端機
        System.out.println(jsonString);

        // 取得回應給前端的Print物件
        PrintWriter pw = response.getWriter();

        // 將資料輸出到前端
        pw.print(jsonString);
    }
}
```
> **提示:**
> 需安裝gson套件

##### WEB-INFO/web.xml
```xml
<web-app>
  <display-name>Archetype Created Web Application</display-name>

  <servlet>
    <servlet-name>Login</servlet-name>
    <servlet-class>com.Login</servlet-class>
  </servlet>
  <servlet-mapping>
    <servlet-name>Login</servlet-name>
    <url-pattern>/login</url-pattern>
  </servlet-mapping>
</web-app>
```

#### 測試
直接用瀏覽器輸入URL: http://localhost:8080/mysystem/login?username=aaron&code=1234
會看到:
```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "account": "aaron",
    "password": "1234"
  }
}
```


#### 連接資料庫後的API程式碼
```java
package com;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.google.gson.Gson;

import java.sql.Connection;
import java.sql.Statement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.DriverManager;


class LoginResult {
    public LoginResult(String account, String password) {
        this.account = account;
        this.password = password;
    }

    String account;
    String password;    
}

// API的response 資料結構
class ActionResult {
    int code;       // 狀態碼
    String message; // 訊息描述

    LoginResult data; // 登入後預計回傳的資料

    public ActionResult(int code, String message, LoginResult data) {
        this.code = code;
        this.message = message;
        this.data = data;
    }
}

public class Login extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
        // 接收前端網頁傳來的username和password參數
        String username = request.getParameter("username");
        String password = request.getParameter("code");

        // 設定編碼
        response.setContentType("application/json;charset=UTF-8");

        // 登入
        String msg = login(username, password);

        // 準備要回傳給前端的資料(0=成功, 1=失敗)
        ActionResult actionResult = 
            new ActionResult(msg.length() == 0 ? 0:1, msg.length() == 0 ? "登入成功":msg, new LoginResult(username, password));

        // 將Java物件轉換成JSON字串才能往前端傳遞
        String jsonString = new Gson().toJson(actionResult);

        // 輸出到終端機
        System.out.println(jsonString);

        // 取得回應給前端的Print物件
        PrintWriter pw = response.getWriter();

        // 將資料輸出到前端
        pw.print(jsonString);
    }

    // 驗證帳號跟密碼是否存在資料庫
    protected String login(String username, String password)  {
        Connection conn = null;  // 連接資料庫用
        Statement stmt = null;   // 下SQL語法用 
        ResultSet rs = null;     // 取得SQL結果用

        // 1. 註冊驅動程式
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");

            // 2. 連接資料庫
            conn = DriverManager.getConnection("jdbc:mysql://localhost/my-system?user=root&password=3939889");

            // 3. 取得statement物件
            stmt = conn.createStatement();

            // 4. 查詢資料庫
            rs = stmt.executeQuery("select count(*) as c from account a where name='" + username + "' and code='" + password + "';");

            // 取得c欄位的資料
            rs.next(); // 將資料指向第一筆
            int count = rs.getInt("c");

            rs.close();
            stmt.close();
            conn.close();

            // 沒有查詢到資料=登入失敗
            // if(count == 0) {
            //     return false;
            // } 
            // else {
            //     return true;
            // }

            return count != 0 ? "" : "帳號錯誤";

        } catch (ClassNotFoundException e) {
            
            return "ClassNotFoundException";
        } catch(SQLException e) {
            return e.getMessage();
        } 
    }
}

```

## 2023-11-08
#### 使用Vue.js框架
官方文件: https://vuejs.org/guide/quick-start.html

1. 引入Vue.js CDN
```
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
```

#### 建立Vue網頁
```javascript
<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>CodePen - Hacker Login Form</title>

  <link rel="stylesheet" href="./style.css"> 

  <!-- 1. 引入Vue.js框架 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- 引入axios套件，用來串接API -->
  <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>

 </head> 

 <!-- 2. 加上app id來讓vue接管網頁-->
 <body id="app"> <!-- partial:index.partial.html --> 

  <section> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> 

   <div class="signin"> 

    <div class="content"> 

     <h2 @click="testClick()">{{ test }} Sign In</h2> 

     <div class="form"> 

      <div class="inputBox"> 
        
       <!-- 綁定username變數給input -->
       <input v-model="username" type="text" name="username" required> <i>帳號 {{ message }}</i> 

      </div> 

      <div class="inputBox"> 
      <!-- 綁定password變數給input -->
       <input v-model="password" type="password" name="code" required> <i>密碼</i> 
      </div> 
      <div v-if="isShowLoginError" class="login-failed">登入失敗</div>

      <div class="links"> <a href="#">Forgot Password</a> <a href="#">Signup</a> 

      </div> 
      <!-- <div>{{ message }}</div>
      <button @click="count++">
        Count is: {{ count }}
      </button> -->

      <div class="inputBox"> 

       <input type="submit" value="登入" @click="login()"> 

      </div> 

     </div> 

    </div> 

   </div> 

  </section> <!-- partial --> 


 </body>

 <!-- 3.建立Vue物件並初始化 -->
 <script>
  const { createApp } = Vue

  // vue初始化
  createApp(
    {
      data() {
        return {
          count: 0,
          message: 'Hello Vue!',
          test: 'Aaron',
          username: '',  // 用來存放使用者輸入的帳號用
          password: '',  // 用來存放使用者輸入的密碼用
          isShowLoginError: false,
        }
      },
      // Vue要使用的方法
      methods: {
        testClick() {
          // alert('Hi Vue');
          this.test = 'Andy';
        },
        // 登入用的方法
        login() {
          // alert('Login');
          console.log('Login'); // System.out.println()
          console.log('username=' + this.username);
          console.log('password=' + this.password);

          // 串接登入API
          axios.get('/mysystem/login?username=' + this.username + '&code=' + this.password)
          .then( (response) => {
            console.log(response);

            // 處理API的回應
            if(response.status == 200) {
              console.log('呼叫API成功');
              if(response.data.code > 0) { // 登入失敗
                console.log('登入失敗:' + response.data.message);
                this.isShowLoginError = true;
              } else {
                console.log('登入成功');
                location.href = 'https://www.yahoo.com.tw';   // 跳轉網頁
              }

            }
          });

        }
      }
    }
  ).mount('#app');

 </script>

</html>

```

#### 自己加的樣式
```css
.login-failed {
  color: red;
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: -10px;
}
```

## 2023-11-10
###### product.html
```html
<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>CodePen - NFT Card Component</title>
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="./product.css">

   <!-- 1. 引入Vue.js框架 -->
   <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

   <!-- 引入axios套件，用來串接API -->
   <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>

</head>

<body id="app">
  <div class="bg">
    <h1>Kiberbash</h1>
  </div>

  <div class="container">
    <!-- 卡片資料 -->
    <div v-for="p in data" class="nft">
      <div class='main'>
        <img class='tokenImage' :src="p.photoUrl" alt="NFT" />
        <h2>{{ p.title }}</h2>
        <p class='description'>{{ p.description }}</p>
        <div class='tokenInfo'>
          <div class="price">
            <ins>$</ins>
            <p>{{ p.price }}</p>
          </div>
          <!-- <div class="duration">
            <ins>◷</ins>
            <p>11 days left</p>
          </div> -->
        </div>
        <hr />
        <div class='creator'>
          <div class='wrapper'>
            <img :src="p.storeUrl" alt="Creator" />
          </div>
          <p><ins>{{ p.storeName }}</p>
        </div>
      </div>
    </div>
  </div>

  

</body>
<script>
  const { createApp } = Vue

  // vue初始化
  createApp(
    {
      data() {
        return {
          // 存放商品資訊
          data: [
            {
              title: '商店標題1',
              description: '商店描述1',
              price: '$ 10,000'
            },
            {
              title: '商店標題2',
              description: '商店描述2',
              price: '$ 20,000'
            },
            {
              title: '商店標題3',
              description: '商店描述3',
              price: '$ 30,000'
            },
            {
              title: '商店標題1',
              description: '商店描述1',
              price: '$ 10,000'
            },
            {
              title: '商店標題2',
              description: '商店描述2',
              price: '$ 20,000'
            },
           
          ]
        }
      },
      // Vue要使用的方法
      methods: {
       
      },
      // 這個方法會網頁載入完畢後會自動被呼叫
      mounted() {
        // 打API要商品資訊
        axios.get('/mysystem/product')
          .then((response) => {
            // 處理API的response
            console.log(response);

            if(response.status == 200) { // API呼叫成功 
              if(response.data.code == 0)  // 取的資料成功
               this.data = response.data.data; // 將商品資訊存到變數內
              else
               this.data =[];  // 清空資料
            }
          });
      }
    }
  ).mount('#app');

 </script>
</html>
```
###### product.css
```css
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: #161418;
  color: #eee;
  user-select: none;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, "Courier New", monospace;
}

.nft {
  user-select: none;
  max-width: 300px;
  min-width: 300px;
  margin: 5rem auto;
  border: 1px solid #ffffff22;
  background-color: #282c34;
  background: linear-gradient(0deg, #282c34 0%, rgba(17, 0, 32, 0.5) 100%);
  box-shadow: 0 7px 20px 5px #00000088;
  border-radius: 0.7rem;
  backdrop-filter: blur(7px);
  -webkit-backdrop-filter: blur(7px);
  overflow: hidden;
  transition: 0.5s all;
}
.nft hr {
  width: 100%;
  border: none;
  border-bottom: 1px solid #88888855;
  margin-top: 0;
}
.nft ins {
  text-decoration: none;
}
.nft .main {
  display: flex;
  flex-direction: column;
  width: 90%;
  padding: 1rem;
}
.nft .main .tokenImage {
  border-radius: 0.5rem;
  max-width: 100%;
  height: 250px;
  object-fit: cover;
}
.nft .main .description {
  margin: 0.5rem 0;
  color: #a89ec9;
}
.nft .main .tokenInfo {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.nft .main .tokenInfo .price {
  display: flex;
  align-items: center;
  color: #ee83e5;
  font-weight: 700;
}
.nft .main .tokenInfo .price ins {
  margin-left: -0.3rem;
  margin-right: 0.5rem;
}
.nft .main .tokenInfo .duration {
  display: flex;
  align-items: center;
  color: #a89ec9;
  margin-right: 0.2rem;
}
.nft .main .tokenInfo .duration ins {
  margin: 0.5rem;
  margin-bottom: 0.4rem;
}
.nft .main .creator {
  display: flex;
  align-items: center;
  margin-top: 0.2rem;
  margin-bottom: -0.3rem;
}
.nft .main .creator ins {
  color: #a89ec9;
  text-decoration: none;
}
.nft .main .creator .wrapper {
  display: flex;
  align-items: center;
  border: 1px solid #ffffff22;
  padding: 0.3rem;
  margin: 0;
  margin-right: 0.5rem;
  border-radius: 100%;
  box-shadow: inset 0 0 0 4px #000000aa;
}
.nft .main .creator .wrapper img {
  border-radius: 100%;
  border: 1px solid #ffffff22;
  width: 2rem;
  height: 2rem;
  object-fit: cover;
  margin: 0;
}
.nft ::before {
  position: fixed;
  content: "";
  box-shadow: 0 0 100px 40px #ffffff08;
  top: -10%;
  left: -100%;
  transform: rotate(-45deg);
  height: 60rem;
  transition: 0.7s all;
}
.nft:hover {
  border: 1px solid #ffffff44;
  box-shadow: 0 7px 50px 10px #000000aa;
  transform: scale(1.015);
  filter: brightness(1.3);
}
.nft:hover ::before {
  filter: brightness(0.5);
  top: -100%;
  left: 200%;
}

.bg {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.bg h1 {
  font-size: 20rem;
  filter: opacity(0.5);
}

.container {
  display: flex;
  gap: 10px;
  margin: 10px;
  flex-wrap: wrap;
}
```

###### Product.java
```java
package com;

import java.io.IOException;
import java.io.PrintWriter;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.Statement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.google.gson.Gson;

// 一筆商品資料的格式
class ProductEntity {
    int id;
    String photoUrl;
    String title;
    String description;
    int price;
    String storeUrl;
    String storeName;
}

// API回應用的資料格式
class ResponseProductEntity {
    int code;
    String message;

    ArrayList<ProductEntity> data;
}

public class Product extends HttpServlet{
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)  {
        // 1. 設定要回應的資料格式
        response.setContentType("application/json;charset=UTF-8");

        // 2. 到資料庫select所有商品資料
        ArrayList<ProductEntity> products = getProductList();

        // 3. 準備response物件
        ResponseProductEntity responseProductEntity = new ResponseProductEntity();

        // 如果陣列是null, 代表select失敗
        responseProductEntity.code = products == null ? 1 : 0;
        responseProductEntity.message = products == null ? "取得商品失敗" : "取得商品成功";
        responseProductEntity.data = products;        

        // 4. 將拿到的資料轉成JSON string
        String jsonString = new Gson().toJson(responseProductEntity);

        // 5. 透過PrintWriter輸出
        PrintWriter pw;
        try {
            pw = response.getWriter();
            pw.print(jsonString);
        } catch (IOException e) {
            System.out.println(e.getMessage());
        }
    }

    protected ArrayList<ProductEntity> getProductList() {
        Connection conn = null;  // 連接資料庫用
        Statement stmt = null;   // SQL語法資料用
        ResultSet rs = null;     // select結果接收用

        try {
            // 1. 註冊mySQL驅動程式
            Class.forName("com.mysql.cj.jdbc.Driver");

            // 2. 連接資料庫
            conn = DriverManager.getConnection("jdbc:mysql://localhost/mysystem?user=root&password=3939889");

            // 3. 取得Statement物件
            stmt = conn.createStatement();

            // 4. 下SQL拿資料
            rs = stmt.executeQuery("select * from product");

            // 5. 將SQL回傳的資料存到變數
            ArrayList<ProductEntity> productEntities = new ArrayList<>();

            // 依序一筆一筆拿資料
            while(rs.next()) {
                ProductEntity pe = new ProductEntity();
                pe.id = rs.getInt("id");  // 取得id欄位資料並存到物件內
                pe.photoUrl = rs.getString("photo_url");
                pe.title = rs.getString("title");
                pe.description = rs.getString("description");
                pe.price = rs.getInt("price");
                pe.storeName = rs.getString("store_name");
                pe.storeUrl = rs.getString("store_url");

                productEntities.add(pe); // 存到陣列內
            }
            
            rs.close();
            stmt.close();
            conn.close();

            return productEntities;
        } catch(ClassNotFoundException e) {// 註冊驅動程式會出現的exception
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        } catch(SQLException e) {
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        }
    }
}
```
###### web.xml
```xml
<!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" >

<web-app>
  <display-name>Archetype Created Web Application</display-name>

  <!-- login API設定 -->
  <servlet>
    <servlet-name>Login</servlet-name>
    <servlet-class>com.Login</servlet-class>
  </servlet>
  <servlet-mapping>
    <servlet-name>Login</servlet-name>
    <url-pattern>/login</url-pattern>
  </servlet-mapping>

  <!-- product API設定 -->
  <servlet>
    <servlet-name>Product</servlet-name>
    <servlet-class>com.Product</servlet-class>
  </servlet>
  <servlet-mapping>
    <servlet-name>Product</servlet-name>
    <url-pattern>/product</url-pattern>
  </servlet-mapping>

</web-app>
```

## 2023-11-13
###### 進入Spring Boot的世界
#### 建立Spring Boot專案
1. `Ctrl`+`Shift`+`P` 打開VSCode功能選單
2. 選擇: Create Java Project
3. 選擇: Spring Boot
4. 選擇: Maven Project
5. 選擇: 3.1.5
6. 選擇: Java
7. Group Id: 按Enter
8. Artifact Id: 按Enter
9. War
10. Java Version: 17
11. Dependencies:
   - Spring Web
   - Spring Boot Devtools
   - MySQL Driver
   - Lombok

#### application.properties
調整設定用
##### 修改Tomcat port:
```
server.port = 80
```
#### 建立BaseResponseModel.java
```java
package com.example.myspring.model;

import lombok.Data;

// 所有API Response的父類別
@Data
public class BaseResponseModel {
    int code;
    String message;

    public BaseResponseModel(int code, String message) {
        this.code = code;
        this.message = message;
    }
}
```
#### 建立LoginResponseModel.java
```java
package com.example.myspring.model;

                                                                                                                                                                                                                                                       

@Data
public class LoginResponseModel extends BaseResponseModel {
    String data; // 回傳帳號給前端

    public LoginResponseModel(int code, String message, String data) {
        super(code, message);

        this.data = data;
    }
}
```

> **注意:**
> 請記得幫model class加上`@Data` annotation

#### 建立Login API
```java
package com.example.myspring.controller;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import com.example.myspring.model.LoginResponseModel;


@RestController  
public class LoginController {
    @Value("${spring.datasource.url}")
    private String mysqlUrl;

    @Value("${spring.datasource.username}")
    private String mysqlUsername;

    @Value("${spring.datasource.password}")
    private String mysqlPassword;

    @Value("${spring.datasource.driver-class-name}")
    private String mysqlDriverName;


    @RequestMapping(value = "/login", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity Login(String username, String password) { 
        // 登入
        String result = login(username, password);

        LoginResponseModel response = null;

        if(result.length() == 0) {
            // 成功
            response = new LoginResponseModel(0, "登入成功", username);
        } else {
            // 失敗
            response = new LoginResponseModel(1, result, username);
        }

        return new ResponseEntity<Object>(response, HttpStatus.OK);
    }

    // 驗證帳號跟密碼是否存在資料庫
    protected String login(String username, String password)  {
        Connection conn = null;  // 連接資料庫用
        Statement stmt = null;   // 下SQL語法用 
        ResultSet rs = null;     // 取得SQL結果用

        // 1. 註冊驅動程式
        try {
            Class.forName(this.mysqlDriverName);

            // 2. 連接資料庫
            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            // 3. 取得statement物件
            stmt = conn.createStatement();

            // 4. 查詢資料庫
            rs = stmt.executeQuery("select count(*) as c from account a where name='" + username + "' and code='" + password + "';");

            // 取得c欄位的資料
            rs.next(); // 將資料指向第一筆
            int count = rs.getInt("c");

            rs.close();
            stmt.close();
            conn.close();

            // 沒有查詢到資料=登入失敗
            // if(count == 0) {
            //     return false;
            // } 
            // else {
            //     return true;
            // }

            return count != 0 ? "" : "帳號錯誤";

        } catch (ClassNotFoundException e) {
            
            return "ClassNotFoundException";
        } catch(SQLException e) {
            return e.getMessage();
        } 
    }
}
```

#### application.properites
```
server.port=80

spring.datasource.url=jdbc:mysql://localhost/mysystem
spring.datasource.username=root
spring.datasource.password=3939889
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```
#### ProductModel.java
```java
package com.example.myspring.model;

import lombok.Data;

@Data
public class ProductModel {
    int id;
    String photoUrl;
    String title;
    String description;
    int price;
    String storeUrl;
    String storeName;
}
```

#### ProductResponseModel.java
```java
package com.example.myspring.model;

import java.util.ArrayList;

import lombok.Data;

@Data
public class ProductResponseModel extends BaseResponseModel {
    ArrayList<ProductModel> data;

    public ProductResponseModel(int code, String message, ArrayList<ProductModel> data) {
        super(code, message);

        this.data = data;
    }
}
```

#### ProductController.java
```java
package com.example.myspring.controller;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import com.example.myspring.model.ProductModel;
import com.example.myspring.model.ProductResponseModel;

@RestController
public class ProductController {
    @Value("${spring.datasource.url}")
    private String mysqlUrl;

    @Value("${spring.datasource.username}")
    private String mysqlUsername;

    @Value("${spring.datasource.password}")
    private String mysqlPassword;

    @Value("${spring.datasource.driver-class-name}")
    private String mysqlDriverName;

    @RequestMapping(value = "/product", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity product() {
        ArrayList<ProductModel> result = getProductList();

        if(result == null) // 失敗
            return new ResponseEntity<Object>(new ProductResponseModel(1, "失敗", result), HttpStatus.OK);
        else // 成功
            return new ResponseEntity<Object>(new ProductResponseModel(0, "成功", result), HttpStatus.OK);
    }

    protected ArrayList<ProductModel> getProductList() {
        Connection conn = null;  // 連接資料庫用
        Statement stmt = null;   // SQL語法資料用
        ResultSet rs = null;     // select結果接收用

        try {
            // 1. 註冊mySQL驅動程式
            Class.forName(this.mysqlDriverName);

            // 2. 連接資料庫
            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            // 3. 取得Statement物件
            stmt = conn.createStatement();

            // 4. 下SQL拿資料
            rs = stmt.executeQuery("select * from product");

            // 5. 將SQL回傳的資料存到變數
            ArrayList<ProductModel> productEntities = new ArrayList<>();

            // 依序一筆一筆拿資料
            while(rs.next()) {
                ProductModel pe = new ProductModel();
                pe.setId(rs.getInt("id"));  // 取得id欄位資料並存到物件內
                pe.setPhotoUrl(rs.getString("photo_url"));
                pe.setTitle(rs.getString("title"));
                pe.setDescription(rs.getString("description"));
                pe.setPrice(rs.getInt("price"));
                pe.setStoreName(rs.getString("store_name"));
                pe.setStoreUrl(rs.getString("store_url"));

                productEntities.add(pe); // 存到陣列內
            }
            
            rs.close();
            stmt.close();
            conn.close();

            return productEntities;
        } catch(ClassNotFoundException e) {// 註冊驅動程式會出現的exception
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        } catch(SQLException e) {
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        }
    }
}
```

## 2023-11-14
#### 新增對話視窗到網頁上
1. 尋找樣板: https://codepen.io/ainalem/pen/GRqPwoz
2. 將html原始碼複製到product.html檔案。
	為了不被蓋住，請放在網頁原始法最下方的`</body>`上面。
3. 調整`position`為`fixed`，讓對話盒可以固定在畫面最中間。

#### 新增可以加入商品資料的API
```java=
package com.example.myspring.controller;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.PreparedStatement;
import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import com.example.myspring.model.BaseResponseModel;
import com.example.myspring.model.ProductModel;
import com.example.myspring.model.ProductResponseModel;

@RestController
public class ProductController {
    @Value("${spring.datasource.url}")
    private String mysqlUrl;

    @Value("${spring.datasource.username}")
    private String mysqlUsername;

    @Value("${spring.datasource.password}")
    private String mysqlPassword;

    @Value("${spring.datasource.driver-class-name}")
    private String mysqlDriverName;

    @RequestMapping(value = "/product", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity product() {
        ArrayList<ProductModel> result = getProductList();

        if(result == null) // 失敗
            return new ResponseEntity<Object>(new ProductResponseModel(1, "失敗", result), HttpStatus.OK);
        else // 成功
            return new ResponseEntity<Object>(new ProductResponseModel(0, "成功", result), HttpStatus.OK);
    }

    protected ArrayList<ProductModel> getProductList() {
        Connection conn = null;  // 連接資料庫用
        Statement stmt = null;   // SQL語法資料用
        ResultSet rs = null;     // select結果接收用

        try {
            // 1. 註冊mySQL驅動程式
            Class.forName(this.mysqlDriverName);

            // 2. 連接資料庫
            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            // 3. 取得Statement物件
            stmt = conn.createStatement();

            // 4. 下SQL拿資料
            rs = stmt.executeQuery("select * from product");

            // 5. 將SQL回傳的資料存到變數
            ArrayList<ProductModel> productEntities = new ArrayList<>();

            // 依序一筆一筆拿資料
            while(rs.next()) {
                ProductModel pe = new ProductModel();
                pe.setId(rs.getInt("id"));  // 取得id欄位資料並存到物件內
                pe.setPhotoUrl(rs.getString("photo_url"));
                pe.setTitle(rs.getString("title"));
                pe.setDescription(rs.getString("description"));
                pe.setPrice(rs.getInt("price"));
                pe.setStoreName(rs.getString("store_name"));
                pe.setStoreUrl(rs.getString("store_url"));

                productEntities.add(pe); // 存到陣列內
            }
            
            rs.close();
            stmt.close();
            conn.close();

            return productEntities;
        } catch(ClassNotFoundException e) {// 註冊驅動程式會出現的exception
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        } catch(SQLException e) {
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        }
    }

    @RequestMapping(value = "/product", method = RequestMethod.POST, 
        consumes = MediaType.APPLICATION_JSON_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity addProduct(@RequestBody ProductModel product) {
        String result = insertProduct(product);

        if(result.length() == 0)
            return new ResponseEntity<>(new BaseResponseModel(0, "成功"), HttpStatus.OK);
        else 
            return new ResponseEntity<>(new BaseResponseModel(1, result), HttpStatus.OK);
    }

    protected String insertProduct(ProductModel product) {
        Connection conn = null;
        PreparedStatement stmt = null;

        try {
            Class.forName(this.mysqlDriverName);
            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            // 準備statement的SQL語法
            stmt = conn.prepareStatement("INSERT INTO product VALUES(null, ?, ?, ?, ?, ?, ?)");
            stmt.setString(1, product.getPhotoUrl());
            stmt.setString(2, product.getTitle());
            stmt.setString(3, product.getDescription());
            stmt.setInt(4, product.getPrice());
            stmt.setString(5, product.getStoreUrl());
            stmt.setString(6, product.getStoreName());

            stmt.executeUpdate();

            return "";
        } catch(SQLException e) {
            return e.getMessage();
        } catch(ClassNotFoundException e) {
            return "ClassNotFoundException";
        }
    }
}
```

#### product.html 新增商品API串接
```java
<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Java養成班專題網站</title>
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="./product.css">

   <!-- 1. 引入Vue.js框架 -->
   <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

   <!-- 引入axios套件，用來串接API -->
   <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>

</head>

<body id="app">
  <div class="toast" v-if="isShowToast">{{ toastMessage }}</div>
  <div class="add-btn" @click="isShowForm = true">
    <img src="plus.svg" style="width: 100%;" />
  </div>
  <div class="bg">
    <h1>歡迎{{ username }}</h1>
  </div>
  <div class="nav-bar">
    <button type="text" class="submit" @click="isShowForm = true">新增商品</button>
  </div>
  <div class="container">
    <!-- 卡片資料 -->
    <div v-for="p in data" class="nft">
      <div class='main'>
        <img class='tokenImage' :src="p.photoUrl" alt="NFT" />
        <h2>{{ p.title }}</h2>
        <p class='description'>{{ p.description }}</p>
        <div class='tokenInfo'>
          <div class="price">
            <ins>$</ins>
            <p>{{ p.price }}</p>
          </div>
          <!-- <div class="duration">
            <ins>◷</ins>
            <p>11 days left</p>
          </div> -->
        </div>
        <hr />
        <div class='creator'>
          <div class='wrapper'>
            <img :src="p.storeUrl" alt="Creator" />
          </div>
          <p><ins>{{ p.storeName }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="mask" v-if="isShowForm"></div>

  <!-- 輸入用彈出式表單 -->
  <div class="form" v-if="isShowForm">
    <div class="title">新增商品</div>
    <!-- <div class="subtitle">Let's create your account!</div> -->
    <div class="input-container ic1">
      <input id="firstname" class="input" type="text" placeholder=" " v-model="newProduct.photoUrl" />
      <div class="cut"></div>
      <label for="firstname" class="placeholder">商品圖片位置</label>
    </div>
    <div class="input-container ic2">
      <input id="lastname" class="input" type="text" placeholder=" " v-model="newProduct.title" />
      <div class="cut cut-short"></div>
      <label for="lastname" class="placeholder">商品名稱</label>
    </div>
    <div class="input-container ic2">
      <input id="email" class="input" type="text" placeholder=" " v-model="newProduct.description" />
      <div class="cut cut-short"></div>
      <label for="email" class="placeholder">商品描述</lable>
    </div>
    <div class="input-container ic1">
      <input id="firstname" class="input" type="text" placeholder=" " v-model="newProduct.price" />
      <div class="cut cut-short"></div>
      <label for="firstname" class="placeholder">商品價格</label>
    </div>
    <div class="input-container ic1">
      <input id="firstname" class="input" type="text" placeholder=" " v-model="newProduct.storeUrl" />
      <div class="cut"></div>
      <label for="firstname" class="placeholder">商店圖片位置</label>
    </div>
    <div class="input-container ic1">
      <input id="firstname" class="input" type="text" placeholder=" " v-model="newProduct.storeName" />
      <div class="cut cut-short"></div>
      <label for="firstname" class="placeholder">商店名稱</label>
    </div>
    <div class="btn-group">
      <button type="text" class="submit" @click="isShowForm = false">取消</button>
      <button type="text" class="submit" @click="onSend()">確定</button>
    </div>
  </div>  
  
</body>
<script>
  const { createApp } = Vue

  // vue初始化
  createApp(
    {
      data() {
        return {
          username: '',
          toastMessage: '',
          isShowToast: false,
          isShowForm: false, // 控制新增表單是否要出現

          // 新增商品用的資料結構
          newProduct: {
            photoUrl: '',
            title: '',
            description: '',
            price: 0,
            storeUrl: '',
            storeName: '',
          },
          // 存放商品資訊
          data: []
        }
      },
      // Vue要使用的方法
      methods: {
        // 送出要新增的商品資料
        onSend() {
          axios.post('/product', this.newProduct)
            .then((response) => {
              // 打API成功
              if(response.status == 200 && response.data.code == 0) {
                // alert('新增資料成功');
                this.showToast('新增資料成功');
                
                // 將新增的資料丟給畫面顯示
                this.data.push(this.newProduct);
              } else {
                alert('新增資料失敗');
              }
            });
          // 隱藏對話框
          this.isShowForm = false;
        },
        showToast(msg) {
          this.isShowToast = true;
          this.toastMessage = msg;

          setTimeout(() => {
            this.isShowToast = false;
          }, 2000);
        }
      },
      // 這個方法會網頁載入完畢後會自動被呼叫
      mounted() {
        // 取得網址列參數
        const queryString = window.location.search;
        // 解析參數列
        const parameters = new URLSearchParams(queryString);
        // 取得使用者名稱
        this.username = parameters.get('username');

        // 打API要商品資訊
        axios.get('/product')
          .then((response) => {
            // 處理API的response
            console.log(response);

            if(response.status == 200) { // API呼叫成功 
              if(response.data.code == 0)  // 取的資料成功
               this.data = response.data.data; // 將商品資訊存到變數內
              else
               this.data =[];  // 清空資料
            }
          });
      }
    }
  ).mount('#app');

 </script>
</html>
```

#### product.css
```cbody {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: #161418;
  color: #eee;
  user-select: none;

  align-items: center;
  background-color: #000;
  display: flex;
  flex-direction: column;
  /* justify-content: center; */
  /* height: 100vh; */
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, "Courier New", monospace;
}

.nft {
  user-select: none;
  max-width: 300px;
  min-width: 300px;
  margin: 1rem auto;
  border: 1px solid #ffffff22;
  background-color: #282c34;
  background: linear-gradient(0deg, #282c34 0%, rgba(17, 0, 32, 0.5) 100%);
  box-shadow: 0 7px 20px 5px #00000088;
  border-radius: 0.7rem;
  backdrop-filter: blur(7px);
  -webkit-backdrop-filter: blur(7px);
  overflow: hidden;
  transition: 0.5s all;
  align-self: flex-start;
  justify-self: flex-start;
}
.nft hr {
  width: 100%;
  border: none;
  border-bottom: 1px solid #88888855;
  margin-top: 0;
}
.nft ins {
  text-decoration: none;
}
.nft .main {
  display: flex;
  flex-direction: column;
  width: 90%;
  padding: 1rem;
}
.nft .main .tokenImage {
  border-radius: 0.5rem;
  max-width: 100%;
  height: 250px;
  object-fit: cover;
}
.nft .main .description {
  margin: 0.5rem 0;
  color: #a89ec9;
}
.nft .main .tokenInfo {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.nft .main .tokenInfo .price {
  display: flex;
  align-items: center;
  color: #ee83e5;
  font-weight: 700;
}
.nft .main .tokenInfo .price ins {
  margin-left: -0.3rem;
  margin-right: 0.5rem;
}
.nft .main .tokenInfo .duration {
  display: flex;
  align-items: center;
  color: #a89ec9;
  margin-right: 0.2rem;
}
.nft .main .tokenInfo .duration ins {
  margin: 0.5rem;
  margin-bottom: 0.4rem;
}
.nft .main .creator {
  display: flex;
  align-items: center;
  margin-top: 0.2rem;
  margin-bottom: -0.3rem;
}
.nft .main .creator ins {
  color: #a89ec9;
  text-decoration: none;
}
.nft .main .creator .wrapper {
  display: flex;
  align-items: center;
  border: 1px solid #ffffff22;
  padding: 0.3rem;
  margin: 0;
  margin-right: 0.5rem;
  border-radius: 100%;
  box-shadow: inset 0 0 0 4px #000000aa;
}
.nft .main .creator .wrapper img {
  border-radius: 100%;
  border: 1px solid #ffffff22;
  width: 2rem;
  height: 2rem;
  object-fit: cover;
  margin: 0;
}
.nft ::before {
  position: fixed;
  content: "";
  box-shadow: 0 0 100px 40px #ffffff08;
  top: -10%;
  left: -100%;
  transform: rotate(-45deg);
  height: 60rem;
  transition: 0.7s all;
}
.nft:hover {
  border: 1px solid #ffffff44;
  box-shadow: 0 7px 50px 10px #000000aa;
  transform: scale(1.015);
  filter: brightness(1.3);
}
.nft:hover ::before {
  filter: brightness(0.5);
  top: -100%;
  left: 200%;
}

.bg {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.bg h1 {
  font-size: 20rem;
  filter: opacity(0.5);
}

.container {
  display: flex;
  gap: 10px;
  margin: 10px;
  flex-wrap: wrap;
}

/* form css */
body {
  
}

.form {
  background-color: #15172b;
  border-radius: 20px;
  box-sizing: border-box;
  height: 500px;
  padding: 20px;
  width: 320px;
  position: fixed;
  top: 50px;
}

.title {
  color: #eee;
  font-family: sans-serif;
  font-size: 24px;
  font-weight: 600;
  margin-top: 10px;
}

.subtitle {
  color: #eee;
  font-family: sans-serif;
  font-size: 16px;
  font-weight: 600;
  margin-top: 10px;
}

.input-container {
  height: 40px;
  position: relative;
  width: 100%;
}

.ic1 {
  margin-top: 20px;
}

.ic2 {
  margin-top: 20px;
}

.input {
  background-color: #303245;
  border-radius: 12px;
  border: 0;
  box-sizing: border-box;
  color: #eee;
  font-size: 18px;
  height: 100%;
  outline: 0;
  padding: 4px 20px 0;
  width: 100%;
}

.cut {
  background-color: #15172b;
  border-radius: 10px;
  height: 20px;
  left: 20px;
  position: absolute;
  top: -20px;
  transform: translateY(0);
  transition: transform 200ms;
  width: 79px;
}

.cut-short {
  width: 60px;
}

.input:focus ~ .cut,
.input:not(:placeholder-shown) ~ .cut {
  transform: translateY(8px);
}

.placeholder {
  color: #65657b;
  font-family: sans-serif;
  left: 20px;
  line-height: 14px;
  pointer-events: none;
  position: absolute;
  transform-origin: 0 35px;
  transition: transform 200ms, color 200ms;
  top: 15px;
  font-size: 0.8em;
}

.input:focus ~ .placeholder,
.input:not(:placeholder-shown) ~ .placeholder {
  transform: translateY(-30px) translateX(10px) scale(0.75);
}

.input:not(:placeholder-shown) ~ .placeholder {
  color: #808097;
}

.input:focus ~ .placeholder {
  color: #dc2f55;
}

.submit {
  background-color: #08d;
  border-radius: 12px;
  border: 0;
  box-sizing: border-box;
  color: #eee;
  cursor: pointer;
  font-size: 18px;
  height: 40px;
  margin-top: 20px;
  /* outline: 0;  */
  text-align: center;
  width: 100%;
}

.submit:active {
  background-color: #06b;
}


.btn-group {
  display: flex;
  gap: 20px;
}

.nav-bar {
  width: 100px;
  align-self: flex-end;
  margin-right: 20px;
}

.mask {
  position: fixed;
  width: 100%;
  height: 100vh;
  background-color: #000a;
}

.add-btn {
  width: 50px;
  height: 50px;
  max-height: 50px;
  max-width: 50px;
  background-color:#06b;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5em;
  padding: 0;
  /* padding-bottom: 2px; */
  text-decoration: none;
  gap: 0;
  border: 0;
  
  border-radius: 50px;
  position: fixed;
  right: 20px;
  bottom: 20px;

  z-index: 1;
}

.add-btn:hover {
  background-color: #08d;
}

.toast {
  background-color: #00aa00;
  width: 150px;
  height: 30px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 30px;
  position: fixed;
  top: 10px;
  z-index: 2;
}

```

## 2023-11-15
###### 上課筆記
#### /management/product-list.html
```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>商品管理</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css"
    />

    <!-- 1. 引入Vue.js框架 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- 引入axios套件，用來串接API -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>

    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body id="app">
    <!-- 我們的toast -->
    <div class="toast" v-if="isShowToast">{{ toastMessage }}</div>

    <h1>商品管理</h1>
    <p>這裡是商品管理頁</p>
    <main>
      <table>
        <thead>
          <tr>
            <th>編號</th>
            <th>商品圖</th>
            <th>名稱</th>
            <th>描述</th>
            <th>價格</th>
            <th>商店圖</th>
            <th>商店名</th>
            <th>功能</th>
          </tr>
        </thead>
        <!-- <tfoot>
      <tr>
        <th colspan='8'>
          Year: 2014
        </th>
      </tr>
    </tfoot> -->
        <tbody>
          <tr v-for="p, index in data">
            <td data-title="編號">{{ p.id }}</td>
            <td data-title="商品圖" class="addr-col">{{ p.photoUrl }}</td>
            <td data-title="商品名稱">{{ p.title }}</td>
            <td data-title="商品描述">{{ p.description }}</td>
            <td data-title="價格">{{ p.price }}</td>
            <td data-title="商店圖" class="addr-col">{{ p.storeUrl }}</td>
            <td data-title="商店名">{{ p.storeName }}</td>
            <td class="select">
              <a class="button" @click="onEdit(index)">編輯</a>
              <a class="button" @click="onDelete(index)">刪除</a>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="detail">
        <div class="detail-container">
          <dl>
            <dt>Provider Name</dt>
            <dd>John Doe</dd>
            <dt>E-mail</dt>
            <dd>email@example.com</dd>
            <dt>City</dt>
            <dd>Detroit</dd>
            <dt>Phone-Number</dt>
            <dd>555-555-5555</dd>
            <dt>Last Update</dt>
            <dd>Jun 20 2014</dd>
            <dt>Notes</dt>
            <dd>
              Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec
              odio. Quisque volutpat mattis eros. Nullam malesuada erat ut
              turpis. Suspendisse urna nibh, viverra non, semper suscipit,
              posuere a, pede.
            </dd>
          </dl>
        </div>
        <div class="detail-nav">
          <button class="close">Close</button>
        </div>
      </div>
    </main>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="js/index.js"></script>

    <!-- 純手工對話盒 -->
    <div v-if="isShowModel" class="model-container">
      <div class="model-title">對話和標題</div>
      <div class="model-content">
        <img class="model-icon" src="https://static.vecteezy.com/system/resources/previews/000/440/213/non_2x/question-mark-vector-icon.jpg" />
        <div class="model-message">確定要刪除資料嗎?</div>
      </div>
      <div class="model-content">
        <div class="model-cancel" @click="isShowModel = false">取消</div>
        <div class="model-ok" @click="confirmDelete()">確定</div>
      </div>
    </div>
  </body>
  <script>
    const { createApp } = Vue
  
    // vue初始化
    createApp(
      {
        data() {
          return {
            toastMessage: '',
            isShowToast: false,
            isShowModel: false, // 控制對話盒的顯示
            prepareOnDeleteIndex: -1, // 預計要刪除的資料index

            data: [], // 存放商品清單的變數

          }
        },
        // Vue要使用的方法
        methods: {
          onEdit(index) {
            this.showToast('onEdit: ' + this.data[index].title);
          },
          onDelete(index) {
            this.isShowModel = true;
            this.prepareOnDeleteIndex = index; // 紀錄準備要刪除的index
          },
          confirmDelete() {
            // 呼叫刪除商品的API
            axios.delete('/product/' + this.data[this.prepareOnDeleteIndex].id)
              .then((response) => {
                if(response.status == 200 && response.data.code == 0) {
                  this.showToast('刪除 ' + this.data[this.prepareOnDeleteIndex].id + ' 成功');

                  // 從網頁上移除已經刪除的商品資料
                  this.data.splice(this.prepareOnDeleteIndex, 1);
                } else {
                  this.showToast('刪除 ' + this.data[this.prepareOnDeleteIndex].id + ' 失敗');
                }

                this.isShowModel = false;
                this.prepareOnDeleteIndex = -1; // 紀錄準備要刪除的index
              });
          },
          showToast(msg) {
            this.isShowToast = true;
            this.toastMessage = msg;
  
            setTimeout(() => {
              this.isShowToast = false;
            }, 2000);
          }
        },
        // 這個方法會網頁載入完畢後會自動被呼叫
        mounted() {
          // 打API要商品資訊
          axios.get('/product')
            .then((response) => {
              // 處理API的response
              console.log(response);

              if(response.status == 200) { // API呼叫成功 
                if(response.data.code == 0) { // 取的資料成功
                  this.data = response.data.data; // 將商品資訊存到變數內
                  console.log(this.data);
                }
                else
                  this.data =[];  // 清空資料
              }
            });
        }
      }
    ).mount('#app');
  
   </script>
</html>
```
#### /management/style.css
```css
* {
  box-sizing: border-box;
}

html.open, body.open {
  height: 100%;
  overflow: hidden;
}

html {
  /* padding: 40px; */
  font-size: 62.5%;
}

body {
  padding: 20px;
  background-color: #5BB9B8;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  color: #fff;
  font-size: 1.6rem;
  font-family: 'Lato', sans-serif;
}

p {
  text-align: center;
  margin: 20px 0 60px;
}

main {
  background-color: #2C3845;
}

h1 {
  text-align: center;
  font-weight: 300;
}

table {
  display: block;
}

tr, td, tbody, tfoot {
  display: block;
}

thead {
  display: none;
}

tr {
  padding-bottom: 10px;
}

td {
  padding: 10px 10px 0;
  text-align: center;
  word-break: break-all;
}
td:before {
  content: attr(data-title);
  color: #7a91aa;
  text-transform: uppercase;
  font-size: 1.4rem;
  padding-right: 10px;
  display: block;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  text-align: left;
  font-weight: 700;
}

thead th {
  background-color: #202932;
  color: #fff;
  /* border: 1px solid #202932; */
}

tfoot th {
  display: block;
  padding: 10px;
  text-align: center;
  color: #b8c4d2;
}

.button {
  line-height: 1;
  display: inline-block;
  font-size: 1.2rem;
  text-decoration: none;
  border-radius: 5px;
  color: #fff;
  padding: 8px;
  background-color: #4b908f;
}

.select {
  padding-bottom: 20px;
  border-bottom: 1px solid #28333f;
}
.select:before {
  display: none;
}

.detail {
  background-color: #BD2A4E;
  width: 100%;
  height: 100%;
  padding: 40px 0;
  position: fixed;
  top: 0;
  left: 0;
  overflow: auto;
  -moz-transform: translateX(-100%);
  -ms-transform: translateX(-100%);
  -webkit-transform: translateX(-100%);
  transform: translateX(-100%);
  -moz-transition: -moz-transform 0.3s ease-out;
  -o-transition: -o-transform 0.3s ease-out;
  -webkit-transition: -webkit-transform 0.3s ease-out;
  transition: transform 0.3s ease-out;
}
.detail.open {
  -moz-transform: translateX(0);
  -ms-transform: translateX(0);
  -webkit-transform: translateX(0);
  transform: translateX(0);
}

.detail-container {
  margin: 0 auto;
  padding: 40px;
  max-width: 500px;
}

dl {
  margin: 0;
  padding: 0;
}

dt {
  font-size: 2.2rem;
  font-weight: 300;
}

dd {
  margin: 0 0 40px 0;
  font-size: 1.8rem;
  padding-bottom: 5px;
  border-bottom: 1px solid #ac2647;
  box-shadow: 0 1px 0 #c52c51;
}

.close {
  background: none;
  padding: 18px;
  color: #fff;
  font-weight: 300;
  border: 1px solid rgba(255, 255, 255, 0.4);
  border-radius: 4px;
  line-height: 1;
  font-size: 1.8rem;
  position: fixed;
  right: 40px;
  top: 20px;
  -moz-transition: border 0.3s linear;
  -o-transition: border 0.3s linear;
  -webkit-transition: border 0.3s linear;
  transition: border 0.3s linear;
}
.close:hover, .close:focus {
  background-color: #a82545;
  border: 1px solid #a82545;
}

@media (min-width: 460px) {
  td {
    text-align: left;
  }
  td:before {
    display: inline-block;
    text-align: right;
    width: 140px;
  }

  .select {
    padding-left: 160px;
  }
}
@media (min-width: 720px) {
  table {
    display: table;
  }

  tr {
    display: table-row;
  }

  td, th {
    display: table-cell;
    word-break: break-all;
  }

  tbody {
    display: table-row-group;
  }

  thead {
    display: table-header-group;
  }

  tfoot {
    display: table-footer-group;
  }

  td {
    /* border: 1px solid #28333f; */
  }
  td:before {
    display: none;
  }

  td, th {
    padding: 10px;
  }

  tr:nth-child(2n+2) td {
    background-color: #242e39;
  }

  tfoot th {
    display: table-cell;
  }

  .select {
    padding: 10px;
    /* display: flex; */
    /* flex-wrap: wrap; */
    /* gap: 10px; */
  }

  .select a {
    margin-right: 5px;
    margin-bottom: 5px;
    min-width: 50px;
    text-align: center;
    cursor: pointer;
  }

  .select a:hover {
    background-color: yellowgreen;
  }

  .addr-col {
    max-width: 200px;
    word-break: normal;
    overflow: auto;
    white-space: nowrap;
  }
}

.toast {
  background-color: #00aa00;
  width: 200px;
  height: 30px;
  display: flex;
  justify-content: center;
  align-items: center;
  align-self: center;
  border-radius: 30px;
  position: fixed;
  top: 10px;
  z-index: 2;
  left: 0;
  right: 0;
  margin: auto;
}

/* 以下都是對話盒樣式 */
.model-container {
  display: flex;
  position: fixed;
  width: 400px;
  border-radius: 20px;
  border-bottom-right-radius: 5px;
  border-bottom-left-radius: 5px;
  height: fit-content;
  flex-direction: column;
  background-color: white;
  padding-bottom: 10px;
  left: 0;
  right: 0;
  margin: auto;
  top: 0;
  bottom: 0;
}

.model-title {
  border-top-right-radius: 5px;
  border-top-left-radius: 5px;
  padding: 20px;
  font-size: 1.5em;
  font-weight: 800;
  background-color: #28333f;
}

.model-content {
  display: flex;
  align-items: center;
  padding: 10px 20px 10px 20px;
  gap: 20px;
  justify-content: center;
}

.model-icon {
  width: 32px;
  height: 32px;
  margin: 20px;
  margin-right: 0px;
  background-color: #a82545;
}

.model-message {
  width: 100%;
  color: #202932;
}

.model-cancel, .model-ok {
  width: 160px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: 5px;
}

.model-cancel {
  background-color: #a82545;
}

.model-ok {
  background-color: cadetblue;
}
```

#### ProductController.java
```java
package com.example.myspring.controller;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.PreparedStatement;
import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;

import com.example.myspring.model.BaseResponseModel;
import com.example.myspring.model.ProductModel;
import com.example.myspring.model.ProductResponseModel;

@RestController
public class ProductController {
    @Value("${spring.datasource.url}")
    private String mysqlUrl;

    @Value("${spring.datasource.username}")
    private String mysqlUsername;

    @Value("${spring.datasource.password}")
    private String mysqlPassword;

    @Value("${spring.datasource.driver-class-name}")
    private String mysqlDriverName;

    // 取得所有商品API
    @RequestMapping(value = "/product", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity product() {
        ArrayList<ProductModel> result = getProductList();

        if(result == null) // 失敗
            return new ResponseEntity<Object>(new ProductResponseModel(1, "失敗", result), HttpStatus.OK);
        else // 成功
            return new ResponseEntity<Object>(new ProductResponseModel(0, "成功", result), HttpStatus.OK);
    }

    // 新增商品API
    @RequestMapping(value = "/product", method = RequestMethod.POST, 
        consumes = MediaType.APPLICATION_JSON_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity addProduct(@RequestBody ProductModel product) {
        String result = insertProduct(product);

        if(result.length() == 0)
            return new ResponseEntity<>(new BaseResponseModel(0, "成功"), HttpStatus.OK);
        else 
            return new ResponseEntity<>(new BaseResponseModel(1, result), HttpStatus.OK);
    }

    // 刪除一筆商品API
    @RequestMapping(value = "/product/{id}", method = RequestMethod.DELETE, 
        produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity removeProduct(@PathVariable int id) {
        String result = deleteProduct(id);

        if(result.length() == 0)
            return new ResponseEntity<>(new BaseResponseModel(0, "成功"), HttpStatus.OK);
        else 
            return new ResponseEntity<>(new BaseResponseModel(1, result), HttpStatus.OK);
    }

    protected ArrayList<ProductModel> getProductList() {
        Connection conn = null;  // 連接資料庫用
        Statement stmt = null;   // SQL語法資料用
        ResultSet rs = null;     // select結果接收用

        try {
            // 1. 註冊mySQL驅動程式
            Class.forName(this.mysqlDriverName);

            // 2. 連接資料庫
            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            // 3. 取得Statement物件
            stmt = conn.createStatement();

            // 4. 下SQL拿資料
            rs = stmt.executeQuery("select * from product");

            // 5. 將SQL回傳的資料存到變數
            ArrayList<ProductModel> productEntities = new ArrayList<>();

            // 依序一筆一筆拿資料
            while(rs.next()) {
                ProductModel pe = new ProductModel();
                pe.setId(rs.getInt("id"));  // 取得id欄位資料並存到物件內
                pe.setPhotoUrl(rs.getString("photo_url"));
                pe.setTitle(rs.getString("title"));
                pe.setDescription(rs.getString("description"));
                pe.setPrice(rs.getInt("price"));
                pe.setStoreName(rs.getString("store_name"));
                pe.setStoreUrl(rs.getString("store_url"));

                productEntities.add(pe); // 存到陣列內
            }
            
            rs.close();
            stmt.close();
            conn.close();

            return productEntities;
        } catch(ClassNotFoundException e) {// 註冊驅動程式會出現的exception
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        } catch(SQLException e) {
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        }
    }

    protected String insertProduct(ProductModel product) {
        Connection conn = null;
        PreparedStatement stmt = null;

        try {
            Class.forName(this.mysqlDriverName);
            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            // 準備statement的SQL語法
            stmt = conn.prepareStatement("INSERT INTO product VALUES(null, ?, ?, ?, ?, ?, ?)");
            stmt.setString(1, product.getPhotoUrl());
            stmt.setString(2, product.getTitle());
            stmt.setString(3, product.getDescription());
            stmt.setInt(4, product.getPrice());
            stmt.setString(5, product.getStoreUrl());
            stmt.setString(6, product.getStoreName());

            stmt.executeUpdate();

            return "";
        } catch(SQLException e) {
            return e.getMessage();
        } catch(ClassNotFoundException e) {
            return "ClassNotFoundException";
        }
    }

    protected String deleteProduct(int id) {
        Connection conn = null;
        PreparedStatement stmt;

        try {
            Class.forName(this.mysqlDriverName);

            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            stmt = conn.prepareStatement("DELETE from product WHERE id = ?");
            stmt.setInt(1, id);
            stmt.executeUpdate();

            return "";
        } catch(SQLException e) {
            return e.getMessage();
        } catch(ClassNotFoundException e) {
            return "ClassNotFoundException";
        }
    }
}
```

## 2023-11-16
###### 上課筆記
#### 今日目標
完成商品編輯功能
#### ProductController.java
```java
package com.example.myspring.controller;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.PreparedStatement;
import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;

import com.example.myspring.model.BaseResponseModel;
import com.example.myspring.model.ProductModel;
import com.example.myspring.model.ProductResponseModel;

@RestController
public class ProductController {
    @Value("${spring.datasource.url}")
    private String mysqlUrl;

    @Value("${spring.datasource.username}")
    private String mysqlUsername;

    @Value("${spring.datasource.password}")
    private String mysqlPassword;

    @Value("${spring.datasource.driver-class-name}")
    private String mysqlDriverName;

    // 取得所有商品API
    @RequestMapping(value = "/product", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity getProduct() {
        ArrayList<ProductModel> result = getProductList();

        if(result == null) // 失敗
            return new ResponseEntity<Object>(new ProductResponseModel(1, "失敗", result), HttpStatus.OK);
        else // 成功
            return new ResponseEntity<Object>(new ProductResponseModel(0, "成功", result), HttpStatus.OK);
    }

    // 新增商品API
    @RequestMapping(value = "/product", method = RequestMethod.POST, 
        consumes = MediaType.APPLICATION_JSON_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity postProduct(@RequestBody ProductModel product) {
        String result = insertProduct(product);

        if(result.length() == 0)
            return new ResponseEntity<>(new BaseResponseModel(0, "成功"), HttpStatus.OK);
        else 
            return new ResponseEntity<>(new BaseResponseModel(1, result), HttpStatus.OK);
    }

    // 修改商品API
    @RequestMapping(value = "/product", method = RequestMethod.PUT,
        consumes = MediaType.APPLICATION_JSON_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity putProduct(@RequestBody ProductModel product) {
        String result = updateProduct(product);

        if(result.length() == 0)
            return new ResponseEntity<>(new BaseResponseModel(0, "成功"), HttpStatus.OK);
        else 
            return new ResponseEntity<>(new BaseResponseModel(1, result), HttpStatus.OK);
    }
        
    // 刪除一筆商品API
    @RequestMapping(value = "/product/{id}", method = RequestMethod.DELETE, 
        produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity removeProduct(@PathVariable int id) {
        String result = deleteProduct(id);

        if(result.length() == 0)
            return new ResponseEntity<>(new BaseResponseModel(0, "成功"), HttpStatus.OK);
        else 
            return new ResponseEntity<>(new BaseResponseModel(1, result), HttpStatus.OK);
    }

    protected ArrayList<ProductModel> getProductList() {
        Connection conn = null;  // 連接資料庫用
        Statement stmt = null;   // SQL語法資料用
        ResultSet rs = null;     // select結果接收用

        try {
            // 1. 註冊mySQL驅動程式
            Class.forName(this.mysqlDriverName);

            // 2. 連接資料庫
            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            // 3. 取得Statement物件
            stmt = conn.createStatement();

            // 4. 下SQL拿資料
            rs = stmt.executeQuery("select * from product");

            // 5. 將SQL回傳的資料存到變數
            ArrayList<ProductModel> productEntities = new ArrayList<>();

            // 依序一筆一筆拿資料
            while(rs.next()) {
                ProductModel pe = new ProductModel();
                pe.setId(rs.getInt("id"));  // 取得id欄位資料並存到物件內
                pe.setPhotoUrl(rs.getString("photo_url"));
                pe.setTitle(rs.getString("title"));
                pe.setDescription(rs.getString("description"));
                pe.setPrice(rs.getInt("price"));
                pe.setStoreName(rs.getString("store_name"));
                pe.setStoreUrl(rs.getString("store_url"));

                productEntities.add(pe); // 存到陣列內
            }
            
            rs.close();
            stmt.close();
            conn.close();

            return productEntities;
        } catch(ClassNotFoundException e) {// 註冊驅動程式會出現的exception
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        } catch(SQLException e) {
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        }
    }

    protected String insertProduct(ProductModel product) {
        Connection conn = null;
        PreparedStatement stmt = null;

        try {
            Class.forName(this.mysqlDriverName);
            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            // 準備statement的SQL語法
            stmt = conn.prepareStatement("INSERT INTO product VALUES(null, ?, ?, ?, ?, ?, ?)");
            stmt.setString(1, product.getPhotoUrl());
            stmt.setString(2, product.getTitle());
            stmt.setString(3, product.getDescription());
            stmt.setInt(4, product.getPrice());
            stmt.setString(5, product.getStoreUrl());
            stmt.setString(6, product.getStoreName());

            stmt.executeUpdate();

            return "";
        } catch(SQLException e) {
            return e.getMessage();
        } catch(ClassNotFoundException e) {
            return "ClassNotFoundException";
        }
    }

    // 資料庫操作: update
    protected String updateProduct(ProductModel product) {
        Connection conn = null;
        PreparedStatement stmt = null;

        try {
            Class.forName(this.mysqlDriverName);

            // 資料庫連線
            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            stmt = conn.prepareStatement("update product set photo_url=?, title=?, description=?, price=?, store_url=?, store_name=? where id=?");
            stmt.setString(1, product.getPhotoUrl());
            stmt.setString(2, product.getTitle());
            stmt.setString(3, product.getDescription());
            stmt.setInt(4, product.getPrice());
            stmt.setString(5, product.getStoreUrl());
            stmt.setString(6, product.getStoreName());
            stmt.setInt(7, product.getId());
            stmt.executeUpdate();

            return "";
        } catch(SQLException e) {
            return e.getMessage();
        } catch(ClassNotFoundException e) {
            return "ClassNotFoundException";
        }
    }

    // 資料庫操作: delete
    protected String deleteProduct(int id) {
        Connection conn = null;
        PreparedStatement stmt;

        try {
            Class.forName(this.mysqlDriverName);

            conn = DriverManager.getConnection(this.mysqlUrl + "?user=" + this.mysqlUsername + "&password=" + this.mysqlPassword);

            stmt = conn.prepareStatement("DELETE from product WHERE id = ?");
            stmt.setInt(1, id);
            stmt.executeUpdate();

            return "";
        } catch(SQLException e) {
            return e.getMessage();
        } catch(ClassNotFoundException e) {
            return "ClassNotFoundException";
        }
    }
}
```

#### /management/product-list.html
```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>商品管理</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css"
    />

    <!-- 1. 引入Vue.js框架 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- 引入axios套件，用來串接API -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>

    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body id="app">
    <!-- 我們的toast -->
    <div class="toast" v-if="isShowToast">{{ toastMessage }}</div>

    <h1>商品管理</h1>
    <p>這裡是商品管理頁</p>
    <main>
      <table>
        <thead>
          <tr>
            <th>編號</th>
            <th>商品圖</th>
            <th>名稱</th>
            <th>描述</th>
            <th>價格</th>
            <th>商店圖</th>
            <th>商店名</th>
            <th>功能</th>
          </tr>
        </thead>
        <!-- <tfoot>
      <tr>
        <th colspan='8'>
          Year: 2014
        </th>
      </tr>
    </tfoot> -->
        <tbody>
          <tr v-for="p, index in data">
            <td data-title="編號">{{ p.id }}</td>
            <td data-title="商品圖" class="addr-col">
              <div v-if="!dataEdiorMode[index]">{{ p.photoUrl }}</div>
              <input v-else class="editor-input" v-model="tempData[index].photoUrl" />
            </td>
            <td data-title="商品名稱">
              <div v-if="!dataEdiorMode[index]">{{ p.title }}</div>
              <input v-else class="editor-input" v-model="tempData[index].title" />
            </td>
            <td data-title="商品描述">
              <div v-if="!dataEdiorMode[index]">{{ p.description }}</div>
              <input v-else class="editor-input" v-model="tempData[index].description" />
            </td>
            <td data-title="價格">
              <div v-if="!dataEdiorMode[index]">{{ p.price }}</div>
              <input v-else class="editor-input" v-model="tempData[index].price" />
            </td>
            <td data-title="商店圖" class="addr-col">
              <div v-if="!dataEdiorMode[index]">{{ p.storeUrl }}</div>
              <input v-else class="editor-input" v-model="tempData[index].storeUrl" />
            </td>
            <td data-title="商店名">
              <div v-if="!dataEdiorMode[index]">{{ p.storeName }}</div>
              <input v-else class="editor-input" v-model="tempData[index].storeName" />
            </td>
            <td v-if="!dataEdiorMode[index]" class="select">
              <a class="button" @click="onEdit(index)">編輯</a>
              <a class="button" @click="onDelete(index)">刪除</a>
            </td>
            <td v-else class="select">
              <a class="button-cancel" @click="onCancelEdit(index)">取消</a>
              <a class="button-ok" @click="onOKEdit(index)">確定</a>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="detail">
        <div class="detail-container">
          <dl>
            <dt>Provider Name</dt>
            <dd>John Doe</dd>
            <dt>E-mail</dt>
            <dd>email@example.com</dd>
            <dt>City</dt>
            <dd>Detroit</dd>
            <dt>Phone-Number</dt>
            <dd>555-555-5555</dd>
            <dt>Last Update</dt>
            <dd>Jun 20 2014</dd>
            <dt>Notes</dt>
            <dd>
              Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec
              odio. Quisque volutpat mattis eros. Nullam malesuada erat ut
              turpis. Suspendisse urna nibh, viverra non, semper suscipit,
              posuere a, pede.
            </dd>
          </dl>
        </div>
        <div class="detail-nav">
          <button class="close">Close</button>
        </div>
      </div>
    </main>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="js/index.js"></script>

    <!-- 純手工對話盒 -->
    <div v-if="isShowModel" class="model-container">
      <div class="model-title">對話和標題</div>
      <div class="model-content">
        <img class="model-icon" src="https://static.vecteezy.com/system/resources/previews/000/440/213/non_2x/question-mark-vector-icon.jpg" />
        <div class="model-message">確定要刪除資料嗎?</div>
      </div>
      <div class="model-content">
        <div class="model-cancel" @click="isShowModel = false">取消</div>
        <div class="model-ok" @click="confirmDelete()">確定</div>
      </div>
    </div>
  </body>
  <script>
    const { createApp } = Vue
  
    // vue初始化
    createApp(
      {
        data() {
          return {
            toastMessage: '',
            isShowToast: false,
            isShowModel: false, // 控制對話盒的顯示
            prepareOnDeleteIndex: -1, // 預計要刪除的資料index

            data: [], // 存放商品清單的變數
            tempData: [], // 存放編輯後的資料用
            dataEdiorMode: [],
          }
        },
        // Vue要使用的方法
        methods: {
          onEdit(index) {
            this.dataEdiorMode[index] = true; // 進入編輯模式

            // 複製資料到編輯用的tempData陣列內
            this.tempData[index] = JSON.parse(JSON.stringify(this.data[index]));
          },
          onDelete(index) {
            this.isShowModel = true;
            this.prepareOnDeleteIndex = index; // 紀錄準備要刪除的index
          },
          onCancelEdit(index) {
            this.dataEdiorMode[index] = false; // 離開編輯模式
          },
          // 確定編輯
          onOKEdit(index) {
          
            // 呼叫Update product API
            axios.put('http://localhost/product', this.tempData[index])
              .then((response) => {
                if(response.status == 200 && response.data.code == 0) {// 更新成功
                  // 更新原本的資料畫面
                  this.data[index] = this.tempData[index];

                  // 成功再離開編輯模式
                  this.onCancelEdit(index);

                  this.showToast('更新 ' + this.data[index].title + ' 成功');
                } else {
                  this.showToast('更新 ' + this.data[index].title + ' 失敗');
                }
              });
          },
          confirmDelete() {
            // 呼叫刪除商品的API
            axios.delete('/product/' + this.data[this.prepareOnDeleteIndex].id)
              .then((response) => {
                if(response.status == 200 && response.data.code == 0) {
                  this.showToast('刪除 ' + this.data[this.prepareOnDeleteIndex].id + ' 成功');

                  // 從網頁上移除已經刪除的商品資料
                  this.data.splice(this.prepareOnDeleteIndex, 1);
                } else {
                  this.showToast('刪除 ' + this.data[this.prepareOnDeleteIndex].id + ' 失敗');
                }

                this.isShowModel = false;
                this.prepareOnDeleteIndex = -1; // 紀錄準備要刪除的index
              });
          },
          showToast(msg) {
            this.isShowToast = true;
            this.toastMessage = msg;
  
            setTimeout(() => {
              this.isShowToast = false;
            }, 2000);
          }
        },
        // 這個方法會網頁載入完畢後會自動被呼叫
        mounted() {
          // 打API要商品資訊
          axios.get('http://localhost/product')
            .then((response) => {
              // 處理API的response
              console.log(response);

              if(response.status == 200) { // API呼叫成功 
                if(response.data.code == 0) { // 取的資料成功
                  this.data = response.data.data; // 將商品資訊存到變數內
                  console.log(this.data);
                }
                else
                  this.data =[];  // 清空資料
              }
            });
        }
      }
    ).mount('#app');
  
   </script>
</html>
```

#### 使用Bean調整專案架構
#### /bean/MySqlConfigBean.java
```java
package com.example.myspring.bean;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import lombok.Data;

@Component
@Data
public class MySqlConfigBean {
    @Value("${spring.datasource.url}")
    private String mysqlUrl;

    @Value("${spring.datasource.username}")
    private String mysqlUsername;

    @Value("${spring.datasource.password}")
    private String mysqlPassword;

    @Value("${spring.datasource.driver-class-name}")
    private String mysqlDriverName;
}
```
#### /controller/BaseController.java
```java
package com.example.myspring.controller;

import org.springframework.beans.factory.annotation.Autowired;

import com.example.myspring.bean.MySqlConfigBean;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.PreparedStatement;

public class BaseController {
    @Autowired
    protected MySqlConfigBean mySqlConfigBean;

    protected Connection conn = null;  // 連接資料庫用
    protected Statement stmt = null;   // 下SQL語法用 
    protected PreparedStatement pstmt = null;
    protected ResultSet rs = null;     // 取得SQL結果用
    
    protected void connect() throws SQLException, ClassNotFoundException {
        // 1. 註冊驅動程式
        Class.forName(mySqlConfigBean.getMysqlDriverName());

        // 2. 連接資料庫
        conn = DriverManager.getConnection(mySqlConfigBean.getMysqlUrl() + 
            "?user=" + mySqlConfigBean.getMysqlUsername() + "&password=" + mySqlConfigBean.getMysqlPassword());
    }
}
```
#### /controller/LoginController.java
```java
package com.example.myspring.controller;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import com.example.myspring.bean.MySqlConfigBean;
import com.example.myspring.model.LoginResponseModel;


@RestController  
public class LoginController extends BaseController {
    @RequestMapping(value = "/login", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity Login(String username, String password) { 
        // 登入
        String result = login(username, password);

        LoginResponseModel response = null;

        if(result.length() == 0) {
            // 成功
            response = new LoginResponseModel(0, "登入成功", username);
        } else {
            // 失敗
            response = new LoginResponseModel(1, result, username);
        }

        return new ResponseEntity<Object>(response, HttpStatus.OK);
    }

    // 驗證帳號跟密碼是否存在資料庫
    protected String login(String username, String password)  {
        try {
            // 連接資料庫
            connect();

            // 3. 取得statement物件
            stmt = conn.createStatement();

            // 4. 查詢資料庫
            rs = stmt.executeQuery("select count(*) as c from account a where name='" + username + "' and code='" + password + "';");

            // 取得c欄位的資料
            rs.next(); // 將資料指向第一筆
            int count = rs.getInt("c");

            rs.close();
            stmt.close();
            conn.close();

            // 沒有查詢到資料=登入失敗
            // if(count == 0) {
            //     return false;
            // } 
            // else {
            //     return true;
            // }

            return count != 0 ? "" : "帳號錯誤";

        } catch (ClassNotFoundException e) {
            
            return "ClassNotFoundException";
        } catch(SQLException e) {
            return e.getMessage();
        } 
    }
}
```
#### /controller/ProductController.java
```java
package com.example.myspring.controller;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.PreparedStatement;
import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import com.example.myspring.bean.MySqlConfigBean;
import com.example.myspring.model.BaseResponseModel;
import com.example.myspring.model.ProductModel;
import com.example.myspring.model.ProductResponseModel;
import com.fasterxml.jackson.databind.JsonSerializable.Base;

@CrossOrigin(origins = "*") // 允許不同網域的網頁來呼叫API
@RestController
public class ProductController extends BaseController {
    // 取得所有商品API
    @RequestMapping(value = "/product", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity getProduct() {
        ArrayList<ProductModel> result = getProductList();

        if(result == null) // 失敗
            return new ResponseEntity<Object>(new ProductResponseModel(1, "失敗", result), HttpStatus.OK);
        else // 成功
            return new ResponseEntity<Object>(new ProductResponseModel(0, "成功", result), HttpStatus.OK);
    }

    // 新增商品API
    @RequestMapping(value = "/product", method = RequestMethod.POST, 
        consumes = MediaType.APPLICATION_JSON_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity postProduct(@RequestBody ProductModel product) {
        String result = insertProduct(product);

        if(result.length() == 0)
            return new ResponseEntity<>(new BaseResponseModel(0, "成功"), HttpStatus.OK);
        else 
            return new ResponseEntity<>(new BaseResponseModel(1, result), HttpStatus.OK);
    }

    // 修改商品API
    @RequestMapping(value = "/product", method = RequestMethod.PUT,
        consumes = MediaType.APPLICATION_JSON_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity putProduct(@RequestBody ProductModel product) {
        String result = updateProduct(product);

        if(result.length() == 0)
            return new ResponseEntity<>(new BaseResponseModel(0, "成功"), HttpStatus.OK);
        else 
            return new ResponseEntity<>(new BaseResponseModel(1, result), HttpStatus.OK);
    }
        
    // 刪除一筆商品API
    @RequestMapping(value = "/product/{id}", method = RequestMethod.DELETE, 
        produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity removeProduct(@PathVariable int id) {
        String result = deleteProduct(id);

        if(result.length() == 0)
            return new ResponseEntity<>(new BaseResponseModel(0, "成功"), HttpStatus.OK);
        else 
            return new ResponseEntity<>(new BaseResponseModel(1, result), HttpStatus.OK);
    }

    protected ArrayList<ProductModel> getProductList() {
        try {
            connect();

            // 3. 取得Statement物件
            stmt = conn.createStatement();

            // 4. 下SQL拿資料
            rs = stmt.executeQuery("select * from product");

            // 5. 將SQL回傳的資料存到變數
            ArrayList<ProductModel> productEntities = new ArrayList<>();

            // 依序一筆一筆拿資料
            while(rs.next()) {
                ProductModel pe = new ProductModel();
                pe.setId(rs.getInt("id"));  // 取得id欄位資料並存到物件內
                pe.setPhotoUrl(rs.getString("photo_url"));
                pe.setTitle(rs.getString("title"));
                pe.setDescription(rs.getString("description"));
                pe.setPrice(rs.getInt("price"));
                pe.setStoreName(rs.getString("store_name"));
                pe.setStoreUrl(rs.getString("store_url"));

                productEntities.add(pe); // 存到陣列內
            }
            
            rs.close();
            stmt.close();
            conn.close();

            return productEntities;
        } catch(ClassNotFoundException e) {// 註冊驅動程式會出現的exception
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        } catch(SQLException e) {
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        }
    }

    protected String insertProduct(ProductModel product) {
        try {
            connect();

            // 準備statement的SQL語法
            pstmt = conn.prepareStatement("INSERT INTO product VALUES(null, ?, ?, ?, ?, ?, ?)");
            pstmt.setString(1, product.getPhotoUrl());
            pstmt.setString(2, product.getTitle());
            pstmt.setString(3, product.getDescription());
            pstmt.setInt(4, product.getPrice());
            pstmt.setString(5, product.getStoreUrl());
            pstmt.setString(6, product.getStoreName());

            pstmt.executeUpdate();

            return "";
        } catch(SQLException e) {
            return e.getMessage();
        } catch(ClassNotFoundException e) {
            return "ClassNotFoundException";
        }
    }

    // 資料庫操作: update
    protected String updateProduct(ProductModel product) {
        try {
            connect();

            pstmt = conn.prepareStatement("update product set photo_url=?, title=?, description=?, price=?, store_url=?, store_name=? where id=?");
            pstmt.setString(1, product.getPhotoUrl());
            pstmt.setString(2, product.getTitle());
            pstmt.setString(3, product.getDescription());
            pstmt.setInt(4, product.getPrice());
            pstmt.setString(5, product.getStoreUrl());
            pstmt.setString(6, product.getStoreName());
            pstmt.setInt(7, product.getId());
            pstmt.executeUpdate();

            return "";
        } catch(SQLException e) {
            return e.getMessage();
        } catch(ClassNotFoundException e) {
            return "ClassNotFoundException";
        }
    }

    // 資料庫操作: delete
    protected String deleteProduct(int id) {
        try {
            connect();

            pstmt = conn.prepareStatement("DELETE from product WHERE id = ?");
            pstmt.setInt(1, id);
            pstmt.executeUpdate();

            return "";
        } catch(SQLException e) {
            return e.getMessage();
        } catch(ClassNotFoundException e) {
            return "ClassNotFoundException";
        }
    }
}
```

## 2023-11-21
#### 安裝前端開發環境
1. 下載node.js: https://nodejs.org/en
2. 安裝node.js: 下一步到底即可
3. 確認node.js是否安裝成功: `$ node -v` 或`$ node --version`

#### yarn套件管理工具
官方文件: https://yarnpkg.com/getting-started/install
1. 安裝`$ corepack enable`
2. 確認安裝是否成功: `$ yarn -v`

#### vite開發工具
官方文件: https://vitejs.dev/guide/
1. 透過yarn指令安裝vite並建立專案: `$ yarn create vite my-vue-app --template vue`
	> 這個指令會在電腦上建立一個新的專案目錄，建議下指令前先切換到適合的磁碟機，例如切換到D磁碟: `C:\Windows\> d:`
2. 啟動專案:
```
$ cd my-vue-app
$ yarn
$ yarn dev
```
會看到如下畫面:
```
  VITE v5.0.0  ready in 360 ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
  ➜  press h + enter to show help
```
打開瀏覽器，並輸入網址: http://localhost:5173/ 即可打開專案網站:
![[Pasted image 20231121100507.png]]

如果打算使用手機打開網站，可以在`$ yarn dev`指令後面加上`--host`參數，例如:
```
$ yarn dev --host
```

會看到如下畫面:
```
 VITE v5.0.0  ready in 376 ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: http://172.19.106.169:5173/
  ➜  press h + enter to show help
```
畫面上中間那個網址(`http://172.19.106.169:5173/`)則是網站在區網內的網址，可以透過該網址來柳覽電腦上的網站。

#### 安裝vue-router
安裝: https://router.vuejs.org/installation.html
教學: https://router.vuejs.org/guide/

##### 加入vue-router相關程式碼
1. 在App.vue內加上`<router-view></router-view>`空標籤，並清除`<template>`標籤內的其他元素。
```html
<template>
  <!-- 1. vue-router:加上router-view空標籤 -->
  <router-view></router-view>
</template>
```
2. 在main.js內 imprt VueRouter需要用到的方法
```
import { createRouter, createWebHistory } from 'vue-router'
```
3.  在main.js內定義URL的對應規則
```javascript
const routes = [
    { 
        path: '/', 
        component: Login, 
    },
    { 
        path: '/login', 
        component: Login2, 
    },
    { 
        path: '/btn', 
        component: MyButtonNo1, 
    },
    {
        path: '/HelloWorld',
        component: HelloWorld
    }
  ]
```
4. 在main.js內建立vue router物件
```javascript
建立vue-router物件
const router = createRouter({
    // 4. Provide the history implementation to use. We are using the hash history for simplicity here.
    history: createWebHistory(),
    routes, // short for `routes: routes`
})
```
> **補充:**
> 官方教學文件使用的是`createWebHashHistory()`，這個會造成網址多一個#字號，所以改用`createWebHistory()`

5. 在main.js內調整vue app初始化方式，並將vue-router設定到vue APP內
```javascript
const app = createApp(App);

// 5. 將vue-router設定到vue APP內
app.use(router);

app.mount('#app');
```

## 2023-11-22
#### 將vue-router相關程式碼從`main.js`搬移到獨立檔案`router.js`
###### router.js
```javascript
// 2. vue-router:imprt VueRouter需要用到的方法
import { createRouter, createWebHistory } from 'vue-router'

import Login from './pages/Login.vue'
import MyButtonNo1 from './components/MyButtonNo1.vue'
import HelloWorld from './components/HelloWorld.vue'

// 3. vue-router: 定義url要跳轉的元件畫面
const routes = [
    { 
        path: '/', 
        component: Login, 
    },
    { 
        path: '/btn', 
        component: MyButtonNo1, 
    },
    {
        path: '/HelloWorld',
        component: HelloWorld
    }
  ]

// 4. vue-router:建立vue-router物件
const router = createRouter({
    // 4. Provide the history implementation to use. We are using the hash history for simplicity here.
    history: createWebHistory(),
    routes, // short for `routes: routes`
})

// 將router物件export給main.js使用
export default {
    router
}
```
###### main.js
```javascript
import { createApp } from 'vue'

import './style.css'
import App from './App.vue'
import router from './router'

// demo import
// import testDemo from './demo'

const app = createApp(App);

// 5. vue-router:將vue-router設定到vue APP內
app.use(router.router);

app.mount('#app');

// demo import
// console.log(testDemo.a1.show());
```

#### 元件之間的雙向溝通
##### 父元件傳遞資料給子元件
###### 子元件要定義props區塊，並設定一個屬性名稱，該屬性可以在元件內當成資料來使用
```javascript
export default {
    props: [
        "message"
    ],
    
    ...
```
###### 父元件透過屬性設定的方式將資料傳遞給子元件
```javascript
<MyButtonNo1 message="登入" />
```
##### 子元件傳遞資料給父元件
###### 父元件在子元件的元素內新增 `@`開頭的事件名稱，後面帶一個方法就可以接收到該元件的事件，該事件並且會自動帶入`$event`參數，這個參數就是子元件傳遞過來的
```javascript
<MyButtonNo1 message="登入" @on10Times="login()" />
```
###### 子元件在需要傳送資料給父元件時，呼叫`$emit`方法
```javascript
this.$emit('on10Times', this.times);
```
## 2023-11-23
###### /src/pages/User.vue
```vue
<template>
    <h1>個人專區</h1>
    <UploadPhoto />

</template>

<script>
import UploadPhoto from '/src/components/UploadPhoto.vue'

export default {
    components: {
        UploadPhoto
    }
}
</script>

<style scoped>

</style>
```
###### (Vue) /src/components/UploadPhoto.vue
```vue
<template>
    <div class="container">
        <div class="upload-photo-container" @dragover.prevent="" @drop.prevent="onDrop($event)">
            <div v-if="isShowPreview" class="preview-container">
                <img class="preview-image" src="/src/assets/photo.png" ref="previewImg" />
            </div>

            <img v-if="isShowPreview" src="/src/assets/close.png" 
                class="close-btn" @click="isShowPreview = false, selectedFile = null"/>

            <div class="title-group">
                <img src="/src/assets/upload.png" class="title-img" />
                <div class="title-text">選擇圖片或拖曳至此處</div>
            </div>
            <div class="title-text-des">僅限PNG圖檔</div>
            <!-- 選檔案的按鈕 -->
            <label>
                <div class="select-file-btn">選擇檔案</div>
                <input type="file" @change="onFileChange($event)" class="input-btn" accept="image/png,image/jpeg">
            </label>
        </div>

        <div v-if="isShowWarning" class="warning-msg">請先選取檔案</div>
        <div class="upload-btn" @click="onUpload()">上傳</div>
    </div>
</template>

<script>
import axios from 'axios';

export default {
    data() {
        return {
            selectedFile: null,
            isShowWarning: false,
            isShowPreview: false,
        }
    },
    methods: {
        onPreview(file) {
            this.isShowPreview = true;
            
            // 把選擇的照片顯示到img標籤
            // const preview = document.querySelector(".preview-image");
            
            // preview.src = URL.createObjectURL($event.target.files[0]);

            this.$nextTick(() => {
                this.$refs.previewImg.src = URL.createObjectURL(file);
            });
        },
        onFileChange($event) {
            // 將使用者選擇的檔案存到變數
            this.selectedFile = $event.target.files[0];
            console.log($event.target.files[0].name);

            this.onPreview($event.target.files[0]);
        },
        onUpload() {
            if(this.selectedFile == null) {
                this.isShowWarning = true;
                return;
            }

            // 準備資料
            const formData = new FormData();
            // 這個files名稱必須跟後端接收參數時設定的名字一樣，否則後端會收不到資料
            formData.append('files', this.selectedFile);

            // 定義API header
            const header = {
                'Content-Type': 'multipart/form-data'
            }

            // 呼叫API
            axios.post('http://localhost:8080/file', formData, {}, header)
                .then((response) => {
                    console.log(response);
                });
        },
        onDrop($event) {
            this.selectedFile = $event.dataTransfer.files[0];
            console.log($event.dataTransfer.files);

            this.onPreview($event.dataTransfer.files[0]);
        }
    }
}
</script>

<style scoped>
.container {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.upload-photo-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    position: relative;
    align-items: center;
    justify-content: center;

    width: 350px;
    height: 200px;
    
    /* background-color: aquamarine; */
    border: 4px dashed #1C7293;
    border-radius: 15px;
}

.upload-btn {
    margin-top: 10px;
    background-color: #1C7293;
    border-radius: 5px;
    color: beige;
    cursor: pointer;
    padding: 5px;
    box-shadow: 2px 2px 10px 2px #222222;
}

.warning-msg {
    color: red;
}

.select-file-btn {
    border: 2px solid #1C7293;
    width: 100px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #1C7293;
    border-radius: 5px;
    cursor: pointer;
}

.input-btn {
    display: none;
}

.preview-container {
    width: 100%;
    height: 100%;
    display: flex;
    position: absolute;
    align-items: center;
    justify-content: center;
    background-color: blueviolet;
}
.preview-image {
    width: 100%;
    height: 100%;
}

.close-btn {
    position: absolute;
    width: 32px;
    height: 32px;
    right: -16px;
    top: -16px;
    cursor: pointer;
}

.title-group {
    display: flex;
    flex-direction: row;
    gap: 10px;
}
.title-img {
    width: 32px;
    height: auto;
}

.title-text {
    color: white;
}

.title-text-des {
    margin-top: -20px;
    color: #1C7293;
    font-size: 0.6em;
}
</style>
```

###### (SpringBoot) /myspring/controller/UploadController.java
```java
package com.example.myspring.controller;

import java.io.File;
import java.io.IOException;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import com.example.myspring.model.BaseResponseModel;
import com.example.myspring.model.UploadPhotoResponseModel;

@CrossOrigin(origins = "*") // 允許不同網域的網頁來呼叫API
@RestController
public class UploadController {
    @Value("${upload.server.path}")
    private String serverUploadPath;

    // 寫成下面的語法即可 @RequestMapping(value = "/file", method = RequestMethod.POST, produces = MediaType.APPLICATION_JSON_VALUE)
    @PostMapping("/file")
    public ResponseEntity uploadFiles(@RequestParam("files") MultipartFile[] files) {
        // 取得上傳的原始檔名
        String filename = files[0].getOriginalFilename();
        System.out.println("上傳: " + filename);

        // 設定儲存的路徑
        String finalPath = new File(this.serverUploadPath + filename).getAbsolutePath();

        try {
            // 儲存檔案
            files[0].transferTo(new File(finalPath));
        } catch (IllegalStateException e) {
            return new ResponseEntity<Object>(new UploadPhotoResponseModel(1, "上傳失敗", e.getMessage()), HttpStatus.OK);
        } catch (IOException e) {
            return new ResponseEntity<Object>(new UploadPhotoResponseModel(2, "上傳失敗", e.getMessage()), HttpStatus.OK);
        }

        return new ResponseEntity<Object>(new UploadPhotoResponseModel(0, "上傳成功", "/images/" + filename), HttpStatus.OK);
    }
}
```
###### (SpringBoot) /myspring/model/UploadPhotoResponseModel.java
```java
package com.example.myspring.model;

import lombok.Data;

@Data
public class UploadPhotoResponseModel extends BaseResponseModel {
    String data; // 存放上傳後的路徑+檔名給前端

    public UploadPhotoResponseModel(int code, String message, String data) {
        super(code, message);

        this.data = data;
    } 
}
```

## 2023-11-24
## git
- git: 版本控管、協同開發的一個規格
- github、gitlab: 提供git雲端服務的廠商
- repository: 儲存庫，通常一個專案會放在一個儲存庫中
- commit: 確認修改，並寫上描述
- push: 將commit好的程式碼推到git伺服器
- pull: 將git伺服器最新的程式碼更新到本地端
   > 如果有發生衝突，需要手動合併發生衝突的檔案

# 安裝Swagger
1. 新增
```xml
<dependency>
   <groupId>org.springdoc</groupId>
   <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
   <version>2.1.0</version>
</dependency>
```
    
2. 瀏覽網址: [http://localhost:8080/v3/api-docs](http://localhost:8080/v3/api-docs)
    
    > Swagger文件
    
3. 瀏覽網址: [http://localhost:8080/swagger-ui/index.html#/](http://localhost:8080/swagger-ui/index.html#/)
    > Swagger UI
4. 如果覺得Swagger UI網址太長，可以設定別名
```
springdoc.swagger-ui.path=/sw
```

### 增加Swagger自訂說明文字

##### [](https://hackmd.io/@aaronlife/2023-java-1-1#%E8%AA%BF%E6%95%B4-Swagger-UI-%E6%9C%80%E4%B8%8A%E9%9D%A2%E7%9A%84%E8%AA%AA%E6%98%8E%E6%96%87%E5%AD%97%E5%92%8C%E7%89%88%E6%9C%AC%E8%99%9F%E7%A2%BC%EF%BC%9A "調整-Swagger-UI-最上面的說明文字和版本號碼：")調整 Swagger UI 最上面的說明文字和版本號碼：

```
@OpenAPIDefinition(info = @Info(title = "健行Java班API系統", version = "1.0.1"))
```

這個API要放到SpringBoot的Application類別內，例如:

```
@OpenAPIDefinition(info = @Info(title = "健行Java班API系統", version = "1.0.1"))
@SpringBootApplication
public class FinalprojectApplication {

    public static void main(String[] args) {
	SpringApplication.run(FinalprojectApplication.class, args);
    }
}
```

##### [](https://hackmd.io/@aaronlife/2023-java-1-1#%E7%9B%B8%E5%90%8CController%E9%A1%9E%E5%88%A5%E4%B8%AD%E7%9A%84-API%E6%9C%83%E8%A2%AB%E6%94%BE%E5%9C%A8%E4%B8%80%E5%80%8B%E6%A8%99%E7%B1%A4%E4%B8%8B%E9%9D%A2%EF%BC%8C%E4%BF%AE%E6%94%B9%E6%A8%99%E7%B1%A4%E7%9A%84%E6%96%B9%E5%BC%8F "相同Controller類別中的-API會被放在一個標籤下面，修改標籤的方式")相同Controller類別中的 API會被放在一個標籤下面，修改標籤的方式:

```java
@Tag(name = "登入")
```

##### [](https://hackmd.io/@aaronlife/2023-java-1-1#%E8%A8%AD%E5%AE%9A%E6%91%98%E8%A6%81%E5%92%8C%E8%AA%AA%E6%98%8E "設定摘要和說明")設定摘要和說明

```java
@Operation(summary = "登入系統", description = "登入這個超級系統")
```

##### [](https://hackmd.io/@aaronlife/2023-java-1-1#%E8%A8%AD%E5%AE%9AAPI%E5%9B%9E%E6%87%89%E8%B3%87%E8%A8%8A "設定API回應資訊")設定API回應資訊

```java
@ApiResponses(value = {
    @ApiResponse(responseCode = "200", description = "API執行成功", content = {
        @Content(mediaType = "application/json", array = @ArraySchema(schema = @Schema(implementation = LoginResponse.class)))
    }),
    @ApiResponse(responseCode = "401", description = "沒有權限", content = {
        @Content()
    }),
    @ApiResponse(responseCode = "500", description = "伺服器內部錯誤", content = {
        @Content()
    })
})
```

> **備註:**  
> `@Tag`和`@Operation`和`ApiResponses`都需要設定在API的方法上，例如:

```java
 @RequestMapping(value = "/login", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
    @Tag(name = "登入API")
    @Operation(summary = "登入系統", description = "登入這個超級系統")
    @ApiResponses(value = {
        @ApiResponse(responseCode = "200", description = "API執行成功", content = {
            @Content(mediaType = "application/json", array = @ArraySchema(schema = @Schema(implementation = BaseResponseModel.class)))
        }),
        @ApiResponse(responseCode = "401", description = "沒有權限", content = {
            @Content()
        }),
        @ApiResponse(responseCode = "999", description = "伺服器內部錯誤", content = {
            @Content()
        })
    })
    public LoginResponse Login(
        @Parameter(description = "帳號名稱", example = "andy") 
        
        (defaultValue = "") String username, 
        @Parameter(description = "密碼", example = "1234") @RequestParam(defaultValue = "") String password) {
        return checkAccount(username, password);
    }
```

##### [](https://hackmd.io/@aaronlife/2023-java-1-1#%E5%8F%83%E6%95%B8%E8%AA%AA%E6%98%8E "參數說明")參數說明

```java
@RequestMapping(value = "/login", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
public LoginResponse Login(
    @Parameter(description = "帳號名稱", example = "andy") @RequestParam(defaultValue = "") String username, 
    @Parameter(description = "密碼", example = "1234") @RequestParam(defaultValue = "") String password) {
    return checkAccount(username, password);
}
```

> **注意:**  
> 參數說命都是設定在方法內的參數列上

##### [](https://hackmd.io/@aaronlife/2023-java-1-1#%E6%B8%85%E5%96%AE%E5%8F%83%E6%95%B8 "清單參數")陣列參數

```
@Parameter(description = "平台分類", example = "[\"A\", \"B\"]") @RequestParam(defaultValue = "") ArrayList<String> platform,
```

> 此範例設定預設值為: [“A”, “B”]

##### [](https://hackmd.io/@aaronlife/2023-java-1-1#%E7%89%A9%E4%BB%B6%E5%8F%83%E6%95%B8 "物件參數")物件參數

先在方法內加入:

```java
public ResponseEntity putProduct(@Parameter(description = "商品資訊") @RequestBody ProductModel product) {
	...
}
```

然後該物件內新`@Schema`註記:

```java
package com.example.myspring.model;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;

@Data
public class ProductModel {
    @Schema(description = "商品id", example = "1")
    int id;

    @Schema(description = "商品照片網址", example = "https://www.xxx.com")
    String photoUrl;

    @Schema(description = "商品名稱")
    String title;

    @Schema(description = "商品描述")
    String description;

    @Schema(description = "商品價格")
    int price;

    @Schema(description = "商店圖片網址")
    String storeUrl;

    @Schema(description = "店家名稱")
    String storeName;
}
```

##### (https://hackmd.io/@aaronlife/2023-java-1-1#%E9%97%9C%E9%96%89Swagger "關閉Swagger")關閉Swagger

```java
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false
```

## 2023-11-27
#### 上課主題
1. Element UI框架使用
2. 分頁功能實作

#### Element UI框架使用
Installation: https://element-plus.org/en-US/guide/installation.html#version
Quick Start: https://element-plus.org/en-US/guide/quickstart.html#full-import
Message: https://element-plus.org/en-US/component/message.html#types
##### 安裝
```bash
$ yarn add element-plus
```

##### import
###### main.js
```javascript
// 引入element ui
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
```
###### Login.vue
```javascript
import { ElMessage } from 'element-plus'

...

// 彈出登入失敗的toast
ElMessage.error('登入失敗');
```

#### 分頁功能開發
###### Product.vue
```javascript
<template>
  <div class="body">
    <div class="toast" v-if="isShowToast">{{ toastMessage }}</div>
    <div class="add-btn" @click="isShowForm = true">
      <img src="/src/assets/plus.svg" style="width: 100%;" />
    </div>
    
    <div class="bg">
      <h1>歡迎{{ username }}</h1>
    </div>
    <div class="nav-bar">
      <button type="text" class="submit" @click="isShowForm = true">新增商品</button>
    </div>
    
    <div class="container">
      <!-- 卡片資料 -->
      <div v-for="p in data" class="nft">
        <div class='main'>
          <img class='tokenImage' :src="p.photoUrl" alt="NFT" />
          <h2>{{ p.title }}</h2>
          <p class='description'>{{ p.description }}</p>
          <div class='tokenInfo'>
            <div class="price">
              <ins>$</ins>
              <p>{{ p.price }}</p>
            </div>
            <!-- <div class="duration">
              <ins>◷</ins>
              <p>11 days left</p>
            </div> -->
          </div>
          <hr />
          <div class='creator'>
            <div class='wrapper'>
              <img :src="p.storeUrl" alt="Creator" />
            </div>
            <p><ins>{{ p.storeName }}</ins></p>
          </div>
        </div>
      </div>

    </div>

    <el-pagination
        style="margin: 50px; z-index: 1;"
        v-model:current-page="currentPage"
        v-model:page-size="pageSize"
        :page-sizes="[3, 9, 15, 30]"
        :small="false"
        :background="true"
        :disabled="false"
        layout="total, sizes, prev, pager, next, jumper"
        :total="total"
        @size-change="handleSizeChange()"
        @current-change="handleCurrentChange()"
      />  

    <div class="mask" v-if="isShowForm"></div>

    <!-- 輸入用彈出式表單 -->
    <div class="form" v-if="isShowForm">
      <div class="title">新增商品</div>
      <!-- <div class="subtitle">Let's create your account!</div> -->
      <div class="input-container ic1">
        <input id="firstname" class="input" type="text" placeholder=" " v-model="newProduct.photoUrl" />
        <div class="cut"></div>
        <label for="firstname" class="placeholder">商品圖片位置</label>
      </div>
      <div class="input-container ic2">
        <input id="lastname" class="input" type="text" placeholder=" " v-model="newProduct.title" />
        <div class="cut cut-short"></div>
        <label for="lastname" class="placeholder">商品名稱</label>
      </div>
      <div class="input-container ic2">
        <input id="email" class="input" type="text" placeholder=" " v-model="newProduct.description" />
        <div class="cut cut-short"></div>
        <label for="email" class="placeholder">商品描述</label>
      </div>
      <div class="input-container ic1">
        <input id="firstname" class="input" type="text" placeholder=" " v-model="newProduct.price" />
        <div class="cut cut-short"></div>
        <label for="firstname" class="placeholder">商品價格</label>
      </div>
      <div class="input-container ic1">
        <input id="firstname" class="input" type="text" placeholder=" " v-model="newProduct.storeUrl" />
        <div class="cut"></div>
        <label for="firstname" class="placeholder">商店圖片位置</label>
      </div>
      <div class="input-container ic1">
        <input id="firstname" class="input" type="text" placeholder=" " v-model="newProduct.storeName" />
        <div class="cut cut-short"></div>
        <label for="firstname" class="placeholder">商店名稱</label>
      </div>
      <div class="btn-group">
        <button type="text" class="submit" @click="isShowForm = false">取消</button>
        <button type="text" class="submit" @click="onSend()">確定</button>
      </div>
    </div>  
  </div>
  
</template>


<script>
import axios from 'axios';

export default {
  data() {
    return {
      // 分頁用的變數
      currentPage: 1,
      pageSize: 3,
      total: 0, // 總筆數

      username: '',
      toastMessage: '',
      isShowToast: false,
      isShowForm: false, // 控制新增表單是否要出現

      // 新增商品用的資料結構
      newProduct: {
        photoUrl: '',
        title: '',
        description: '',
        price: 0,
        storeUrl: '',
        storeName: '',
      },
      // 存放商品資訊
      data: []
    }
  },
  // Vue要使用的方法
  methods: {
    handleSizeChange($event) {
      console.log('handleSizeChange');
      console.log($event);

      // 更新商品卡片
      this.fetchProduct();
    },
    // 切換商品分頁
    handleCurrentChange($event) {
      console.log('handleCurrentChange');
      console.log($event);

      // 更新商品卡片
      this.fetchProduct();
    },
    uploadFile(event) {
      console.log(event.target.files);
      this.$refs.preview.src = URL.createObjectURL(event.target.files[0]);
    },
    // 送出要新增的商品資料
    onSend() {
      axios.post('http://localhost:8080/product', this.newProduct)
        .then((response) => {
          // 打API成功
          if(response.status == 200 && response.data.code == 0) {
            // alert('新增資料成功');
            this.showToast('新增資料成功');
            
            // 將新增的資料丟給畫面顯示
            this.data.push(JSON.parse(JSON.stringify(this.newProduct)));
          } else {
            alert('新增資料失敗');
          }
        });
      // 隱藏對話框
      this.isShowForm = false;
    },
    showToast(msg) {
      this.isShowToast = true;
      this.toastMessage = msg;

      setTimeout(() => {
        this.isShowToast = false;
      }, 2000);
    },
    fetchProduct() {
      // 打API要商品資訊
      axios.get('http://localhost:8080/v2/product?limit=' + this.pageSize + '&offset=' 
                + ((this.currentPage - 1) * this.pageSize) + '&sortMode=0')
        .then((response) => {
          // 處理API的response
          console.log(response);

          if(response.status == 200) { // API呼叫成功 
            if(response.data.code == 0) { // 取的資料成功
              this.data = response.data.data.products; // 將商品資訊存到變數內
              this.total = response.data.data.total;
            }
            else
              this.data =[];  // 清空資料
          }
        });
    }
  },
  // 這個方法會網頁載入完畢後會自動被呼叫
  mounted() {
    // 取得網址列參數
    const queryString = window.location.search;
    // 解析參數列
    const parameters = new URLSearchParams(queryString);
    // 取得使用者名稱
    this.username = parameters.get('username');

    // 更新商品卡片
    this.fetchProduct();
  }
}
</script>

<style scoped>
.body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: #161418;
  color: #eee;
  user-select: none;

  align-items: center;
  background-color: #000;
  display: flex;
  flex-direction: column;
  /* justify-content: center; */
  /* height: 100vh; */
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, "Courier New", monospace;
}

.nft {
  user-select: none;
  max-width: 300px;
  min-width: 300px;
  margin: 1rem auto;
  border: 1px solid #ffffff22;
  background-color: #282c34;
  background: linear-gradient(0deg, #282c34 0%, rgba(17, 0, 32, 0.5) 100%);
  box-shadow: 0 7px 20px 5px #00000088;
  border-radius: 0.7rem;
  backdrop-filter: blur(7px);
  -webkit-backdrop-filter: blur(7px);
  overflow: hidden;
  transition: 0.5s all;
  align-self: flex-start;
  justify-self: flex-start;
}
.nft hr {
  width: 100%;
  border: none;
  border-bottom: 1px solid #88888855;
  margin-top: 0;
}
.nft ins {
  text-decoration: none;
}
.nft .main {
  display: flex;
  flex-direction: column;
  width: 90%;
  padding: 1rem;
}
.nft .main .tokenImage {
  border-radius: 0.5rem;
  max-width: 100%;
  height: 250px;
  object-fit: cover;
}
.nft .main .description {
  margin: 0.5rem 0;
  color: #a89ec9;
}
.nft .main .tokenInfo {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.nft .main .tokenInfo .price {
  display: flex;
  align-items: center;
  color: #ee83e5;
  font-weight: 700;
}
.nft .main .tokenInfo .price ins {
  margin-left: -0.3rem;
  margin-right: 0.5rem;
}
.nft .main .tokenInfo .duration {
  display: flex;
  align-items: center;
  color: #a89ec9;
  margin-right: 0.2rem;
}
.nft .main .tokenInfo .duration ins {
  margin: 0.5rem;
  margin-bottom: 0.4rem;
}
.nft .main .creator {
  display: flex;
  align-items: center;
  margin-top: 0.2rem;
  margin-bottom: -0.3rem;
}
.nft .main .creator ins {
  color: #a89ec9;
  text-decoration: none;
}
.nft .main .creator .wrapper {
  display: flex;
  align-items: center;
  border: 1px solid #ffffff22;
  padding: 0.3rem;
  margin: 0;
  margin-right: 0.5rem;
  border-radius: 100%;
  box-shadow: inset 0 0 0 4px #000000aa;
}
.nft .main .creator .wrapper img {
  border-radius: 100%;
  border: 1px solid #ffffff22;
  width: 2rem;
  height: 2rem;
  object-fit: cover;
  margin: 0;
}
.nft ::before {
  position: fixed;
  content: "";
  box-shadow: 0 0 100px 40px #ffffff08;
  top: -10%;
  left: -100%;
  transform: rotate(-45deg);
  height: 60rem;
  transition: 0.7s all;
}
.nft:hover {
  border: 1px solid #ffffff44;
  box-shadow: 0 7px 50px 10px #000000aa;
  transform: scale(1.015);
  filter: brightness(1.3);
}
.nft:hover ::before {
  filter: brightness(0.5);
  top: -100%;
  left: 200%;
}

.bg {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.bg h1 {
  font-size: 20rem;
  filter: opacity(0.5);
}

.container {
  display: flex;
  gap: 10px;
  margin: 10px;
  flex-wrap: wrap;
}

/* form css */
body {
  
}

.form {
  background-color: #15172b;
  border-radius: 20px;
  box-sizing: border-box;
  height: 500px;
  padding: 20px;
  width: 320px;
  position: fixed;
  top: 50px;
}

.title {
  color: #eee;
  font-family: sans-serif;
  font-size: 24px;
  font-weight: 600;
  margin-top: 10px;
}

.subtitle {
  color: #eee;
  font-family: sans-serif;
  font-size: 16px;
  font-weight: 600;
  margin-top: 10px;
}

.input-container {
  height: 40px;
  position: relative;
  width: 100%;
}

.ic1 {
  margin-top: 20px;
}

.ic2 {
  margin-top: 20px;
}

.input {
  background-color: #303245;
  border-radius: 12px;
  border: 0;
  box-sizing: border-box;
  color: #eee;
  font-size: 18px;
  height: 100%;
  outline: 0;
  padding: 4px 20px 0;
  width: 100%;
}

.cut {
  background-color: #15172b;
  border-radius: 10px;
  height: 20px;
  left: 20px;
  position: absolute;
  top: -20px;
  transform: translateY(0);
  transition: transform 200ms;
  width: 79px;
}

.cut-short {
  width: 60px;
}

.input:focus ~ .cut,
.input:not(:placeholder-shown) ~ .cut {
  transform: translateY(8px);
}

.placeholder {
  color: #65657b;
  font-family: sans-serif;
  left: 20px;
  line-height: 14px;
  pointer-events: none;
  position: absolute;
  transform-origin: 0 35px;
  transition: transform 200ms, color 200ms;
  top: 15px;
  font-size: 0.8em;
}

.input:focus ~ .placeholder,
.input:not(:placeholder-shown) ~ .placeholder {
  transform: translateY(-30px) translateX(10px) scale(0.75);
}

.input:not(:placeholder-shown) ~ .placeholder {
  color: #808097;
}

.input:focus ~ .placeholder {
  color: #dc2f55;
}

.submit {
  background-color: #08d;
  border-radius: 12px;
  border: 0;
  box-sizing: border-box;
  color: #eee;
  cursor: pointer;
  font-size: 18px;
  height: 40px;
  margin-top: 20px;
  /* outline: 0;  */
  text-align: center;
  width: 100%;

  display: flex;
  justify-content: center;
  align-items: center;
}

.submit:active {
  background-color: #06b;
}


.btn-group {
  display: flex;
  gap: 20px;
}

.nav-bar {
  width: 200px;
  align-self: flex-end;
  margin-right: 20px;
}

.mask {
  position: fixed;
  width: 100%;
  height: 100vh;
  background-color: #000a;
}

.add-btn {
  width: 50px;
  height: 50px;
  max-height: 50px;
  max-width: 50px;
  background-color:#06b;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5em;
  padding: 0;
  /* padding-bottom: 2px; */
  text-decoration: none;
  gap: 0;
  border: 0;
  
  border-radius: 50px;
  position: fixed;
  right: 20px;
  bottom: 20px;

  z-index: 1;
}

.add-btn:hover {
  background-color: #08d;
}

.toast {
  background-color: #00aa00;
  width: 150px;
  height: 30px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 30px;
  position: fixed;
  top: 10px;
  z-index: 5;
}
.pagination-block {
  width: 500px;
  height: 100px;
  background-color: #00aa00;
}
</style>
```
###### ProductController.java
```java
@CrossOrigin(origins = "*") // 允許不同網域的網頁來呼叫API
@RestController
public class ProductController extends BaseController {
	...
	
	// 取得所有商品API v2
	@RequestMapping(value = "/v2/product", method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity getProduct(int limit, int offset, int sortMode) {  // 0=升冪, 1=降冪
		ArrayList<ProductModel> result = getProductList(limit, offset, sortMode);
		int total = getProductCount();
	
		ProductPageModel data = new ProductPageModel();
		data.setProducts(result);
		data.setTotal(total);
	
		if(result == null || total == -1) // 失敗
			return new ResponseEntity<Object>(new ProductV2ResponseModel(1, "失敗", data), HttpStatus.OK);
		else // 成功
			return new ResponseEntity<Object>(new ProductV2ResponseModel(0, "成功", data), HttpStatus.OK);
	}
	
	...

// 給取得商品資訊二代API用的方法
    protected ArrayList<ProductModel> getProductList(int limit, int offset, int sortMode ) {
        try {
            connect();

            // 3. 取得Statement物件
            stmt = conn.createStatement();

            String sort = sortMode == 0 ? "ASC" : "DESC";

            // 4. 下SQL拿分頁資料
            String queryString = "select * from product order by price " + sort + " limit " + limit + " offset " + offset;
            rs = stmt.executeQuery(queryString);

            // 5. 將SQL回傳的資料存到變數
            ArrayList<ProductModel> productEntities = new ArrayList<>();

            // 依序一筆一筆拿資料
            while(rs.next()) {
                ProductModel pe = new ProductModel();
                pe.setId(rs.getInt("id"));  // 取得id欄位資料並存到物件內
                pe.setPhotoUrl(rs.getString("photo_url"));
                pe.setTitle(rs.getString("title"));
                pe.setDescription(rs.getString("description"));
                pe.setPrice(rs.getInt("price"));
                pe.setStoreName(rs.getString("store_name"));
                pe.setStoreUrl(rs.getString("store_url"));

                productEntities.add(pe); // 存到陣列內
            }
            
            rs.close();
            stmt.close();
            conn.close();

            return productEntities;
        } catch(ClassNotFoundException e) {// 註冊驅動程式會出現的exception
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        } catch(SQLException e) {
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return null;
        }
    }
    
	// 取得商品總筆數
    protected int getProductCount() {
        try {
            connect();

            // 3. 取得Statement物件
            stmt = conn.createStatement();

            rs = stmt.executeQuery("select count(*) as c from product");

            // 取得總筆數
            rs.next();
            int total = rs.getInt("c");
            
            rs.close();
            stmt.close();
            conn.close();

            return total;
        } catch(ClassNotFoundException e) {// 註冊驅動程式會出現的exception
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return -1;
        } catch(SQLException e) {
            System.out.println("-------------------------------------");
            System.out.println(e.getMessage());
            return -1;
        }
    }
}
```
## 2023-11-28
#### 上課主題
1. Bootstrap UI框架使用
2. Grid網格系統認識
##### 安裝Bootstrap套件
```bash
$ yarn add bootstrap
$ yarn add @popperjs/core
```
##### 安裝sass編譯套件
```bash
$ yarn add sass
```

##### import bootstrap
###### main.js
```javascript
// 引入Bootstrap
// Import all of Bootstrap's JS
import * as bootstrap from 'bootstrap'
import "bootstrap/scss/bootstrap.scss";

...

app.use(bootstrap);

...
```
##### 測試是否引入成功
###### BootstrapProfile.vue
```javascript
<template>
    <div class="container w-100">
        <!-- Content here -->
        <h1>設定</h1>
        <div class="row">
            <img class="col-3" src="/src/assets/japan.jpg" />
            <img class="col-3" src="/src/assets/japan.jpg" />
            <img class="col-3" src="/src/assets/japan.jpg" />
            <!-- <img class="col-3" src="/src/assets/japan.jpg" /> -->
            <div class="col-3 text-primary">
                Hi
                <button type="button" class="btn btn-primary">Primary</button>
                <button type="button" class="btn btn-success">Success</button>

            </div>
        </div>
    </div>
</template>

<script>
export default {

}
</script>

<style scoped>

</style>
```

## 2023-11-29
#### 上課主題
1. 倒計時功能實作
2. 其他效果: Spinner、Progress

#### 倒數計時元件使用
官網: https://github.com/coskuncay/vue3-flip-countdown?ref=madewithvuejs.com

## 2023-11-30
1. 第三方登入串接(Google)

## 2023-12-01
1. Session
2. Filter
3. API安全性


